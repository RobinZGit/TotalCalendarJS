

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <title>КАЛЕНДАРЬ</title>
    <script>

    </script>


     
</head>
 
<body onload="loadTrainData()" onresize="resizeAll()">

<!--
<button id="ttt" style="float:right;height:100px;width:25%" onclick="test()">test </button>
<textarea id="idTestText" style="width:100%;height:400px;" > </textarea>
-->
<div id = "checkPage">
    <div id = "checkPage1" style="height:40px;width:100%;background-color:gray">
        Календарь:<input id = "checkCalendarPage" type="checkbox" style="height:10px" onclick="changePageCalendar(this.checked)">
        Тренировки:<input id = "checkTrainPage" checked= "checked" type="checkbox" style="height:10px" onclick="changePageTrain(this.checked)">
    </div>

</div>
<div id="idImpExpAll">
  <div  style="width:100%"><button  id="btnDownLoad" style="height:24px;background-color:lightgray" onclick="downloadTrainAndCalFromFile(this)">Импорт всех данных о календарях и тренировках в файл .genall</button></div>
  <div style="width:100%"> Загрузить данные о календарях и тренировках из файла .genall:<input type="file" accept=".genall" id="inpLoad" style="background-color:lightgray" onchange="loadTrainAndCalFromFile(this)"> </div>
</div>
<div id = "delimiter1" style="height:5px;width:100%"></div>
<div id="externalcall" style="height:30px;width:100%;background-color:red;display:block"> ПЕРЕД ПЕРЕХОДОМ ПО ССЫЛКЕ НЕ ЗАБУДЬТЕ ВКЛЮЧИТЬ STAYALIVE.
</div>
<div id="calendarPage" style="display:none">
    <div id = idDivCalendar style="font-weight:bold;height:30px"> Календарь тренировок c <input id="inputMinDay" type="number" size="5" value ="0"> по <input id="inputMaxDay" type="number" size="5" value ="1"> дней от сегодняшнего </div>
    <div id = idDivCalendarBtns >
        <button id="btnRecalcCal" style="height:30px;width:49%" onclick='btnRecalcCalOnClick()'> Пересчитать календарь </button>
        <button id="btnImportCal" style="height:30px;width:50%" onclick='btnImportCalOnClick()'> Импорт календаря в формате ICS </button>
    </div>
    <div id = "delimiter2" style="height:5px;width:100%"></div>
    <div><select id="selectedCalendars" multiple="multiple" style="height:100px;width:100%" onchange="onSelectCalendar(this.selectedIndex);" ></select></div>
    <div id="idDivActionCalendar" style="height:20px;overflow-y:scroll;border:2px solid #a1a1a1;">
        <ul id="actionsInCalendar"></ul>
    </div>
</div>
<div id = "delimiter3" style="height:5px;width:100%"></div>
<div id = "trainPage">
    <div id = "idDivAllTrain"  style="font-weight:bold;background:lightgreen"> Выбор тренировки:
        <div>
            <select id="selectAllTrain"  style="height:100px;width:100%" onchange="onSelectTrain(this.selectedIndex);" ></select>
            <div>Тренировка cодержит подстроку (фильтр перед выбором):
                <input id = "filterStr"  style="height:30px;width:20%" onchange="readFilteredListOfTrainings(value,null)">
            </div>
            <div>Выбор нескольких тренировок для одновременного выполнения:
                <input id = "simultMode" type="checkbox" style="height:30px;width:20%" onclick="changeSelectMode(this.checked)">
            </div>
        </div>
    </div>
    <div id="idDivStatrPause" style="font-weight:bold">
        <button id="btnSelectAllTrain" style="height:100px;width:74%" > Начать тренировку </button>
        <button id="btnExit" style="float:right;height:100px;width:25%" onclick="window.close()"> Выход </button>

        Без звука:<input id = "idNoSound" type="checkbox" onclick = "if (!this.checked) document.getElementById('idTextTrain').style.display='none'; else {document.getElementById('idTextTrain').style.display='block'; window.speechSynthesis.cancel()}">
        Темп речи:
        <input id = "inputRate"  style="height:30px;width:5%" value="1.5">

    </div>
    <div id = "delimiter4" style="height:5px;width:100%"></div>
    <div id="idImpExp">
        <button id="btnImportTrain" style="width:50%" onclick='btnImportTrainOnClick()'> Импорт тренировки в файл .rtm </button>
        <div id = "delimiter5" style="height:5px;width:100%"></div>
        <div  id="idRunTrain" style="width:49%"> Запустить тренировку из файла .rtm:<input type="file" accept=".rtm" id="inpRunFromRTM" style="background-color:lightgray" onchange="runFromRTM(this)"> </div>
        <div id = "delimiter6" style="height:5px;width:100%"></div>
        <button id="btnImportTrain2Gen" style="width:50%" onclick='btnImportTrainInGenOnClick()'> Импорт тренировки в файл .gen </button>
        <div id = "delimiter7" style="height:5px;width:100%"></div>
        <div  id="idRunTrainFromGen" style="width:49%"> Запустить тренировку из файла .gen:<input type="file" accept=".gen" id="inpRunFromGen" style="background-color:lightgray" onchange="loadFromGen(this)"> </div>
        <div id = "delimiter8" style="height:5px;width:100%"></div>
    </div>

    <div>
        <textarea id="idTextTrain" style="width:100%;height:350px;font-size: 30px;text-align: center;display:none;"> </textarea>
    </div>

    <div id="idDivTextTime" style="display:none">
        <textarea id="idTextTime" style="width:100%;height:40px;" > </textarea>
    </div>

    <div id = "idDivNavigation" style="display:none;font-weight:bold"> Навигация по текущей тренировке
        <div style="height:100%;overflow-y:scroll;border:2px solid #a1a1a1;">
            <ul id="currentT"></ul>
        </div>
    </div>

    <div>
        <textarea id="idTextsToSpeek" style="width:100%;height:400px;" > </textarea>
    </div>

    <div>
        <button id="btnPrint" style="height:40px;width:100%" onclick='btnPrintOnClick()'> Текст тренировки для печати </button>
    </div>
    <div style="font-size:small;color:blue;">Info: Можно в параметр startwith url-ссылки передать имя тренировки, и форма сразу после запуска покажет ее выбранной</div>
    <div style="font-size:small;color:blue;">Например:  http://localhost:63342/TotalCalendarJS/index.html?_ijt=p3hgufvl6ok7084qaistkcbqgu&_ij_reload&startwith=УПРАЖНЕНИЯ НА ШЕЮ </div>
</div>

<script>


 //надписи на кнопке при изменении статуса тренировки (эти же константы используются как ИД статусов - не делать тексты одинаковыми!)
 const TXT_BTN_NOTSTARTED = "Начать";
 const TXT_BTN_STARTED = "Идет тренировка...";
 const TXT_BTN_PAUSED = "Тренировка приостановлена...";
 const TXT_BTN_FINISHED = "Тренировка завершена";
 var Gl_State = TXT_BTN_NOTSTARTED;
 var Gl_IsFinished =false
 var Gl_BackSpace = "__BCKSPC__"
 //----------------------------------
 var GlnInd=0;
 var GlnDelta=0;
 var Gl_flBegWord = false;
 var Gl_aRithmLisp;
 var GldPrev = new Date();
 var GlflSayIntro = false; //сказано ввведение (сколько времени займет треня и пр.)
 var GlflSayIntro2 = false; //прошло 5000 мс с момента как начал говорить введение
 var GlIsRunning = false
 //----онлайн параметры--------------------------------------
 var _номер_итерации_=0;
 var _history_ = [];
 //-----------------------------------------------------------
 var Gl_SelectedInd=-1; //выбранная тренировка
 var Gl_aMultiCalendar
 var Gl_DaysBeforeNowForShow = 0 //выводить в календаре дела за Gl_DaysBeforeNowForShow дней до сегодняшнего
 var Gl_DaysAfterNowForShow = 1//выводить в календаре дала за Gl_DaysАfterNowForShow дней после сегодняшнего

 var GlBegTime = new Date()

 /*Проверки (д.б) и формат
 заглавные буквы - не листья, строчные - листья
 зарезервированы ,#[]  +BEGIN EVAL PARAMETERS +END EVAL PARAMETERS
 */

 //Календарь тренировок
 var Gl_aMetaMetaCalendar =
       [
           [[new Date(2021,9,29,20,0,0)], //дата начала действия календаря (нач. условие "интегрирования")
            [ "<КАЛЕНДАРЬ ЕЖЕДНЕВНЫЕ>=1000<РАСПИСАНИЕ>",
              //"<РАСПИСАНИЕ>=<УПРАЖНЕНИЯ НА ШЕЮ>;<#0#>;<УПРАЖНЕНИЯ НА СЛАБЫЕ ЗВЕНЬЯ>;<#0#>;<АЭРОБНЫЕ>;<#0#>;<ДЫХАТЕЛЬНАЯ ЛЕСЕНКА>;<#1 [СУТ]#>",
              //"<РАСПИСАНИЕ>=<С АЭРОБНЫМИ>;<#1 [СУТ]#>;<С АЭРОБНЫМИ>;<#1 [СУТ]#>;<БЕЗ АЭРОБНЫХ>;<#1 [СУТ]#>",
              "<РАСПИСАНИЕ>=<РАСТЯЖКА>;<#1 [СУТ]#>;<БАЗОВАЯ>;<#1 [СУТ]#>",
              //"<С АЭРОБНЫМИ>=<УПРАЖНЕНИЯ НА ШЕЮ>;<#0#>;<УПРАЖНЕНИЯ НА СЛАБЫЕ ЗВЕНЬЯ ЧАСТЬ 1>;<#0#>;<АЭРОБНЫЕ>",
              //"<БЕЗ АЭРОБНЫХ>=<УПРАЖНЕНИЯ НА ШЕЮ>;<#0#>;<УПРАЖНЕНИЯ НА СЛАБЫЕ ЗВЕНЬЯ ЧАСТЬ 1>;<#0#>;<ДЫХАТЕЛЬНАЯ ЛЕСЕНКА>",
              "[BEGIN EVAL PARAMETERS]",
              "[END EVAL PARAMETERS]",
            ]
           ],

           [[new Date(2021,10,1,10,0,0)],
            [ "<КАЛЕНДАРЬ ИМ>=1000<РАСПИСАНИЕ1>",
              "<РАСПИСАНИЕ1>=5(<ИМ>;<#90 [МИН]#>);<ИМ>;<#16.5 [ЧАС]#>",
              "[BEGIN EVAL PARAMETERS]",
              "[END EVAL PARAMETERS]",
            ]
           ],

           [[new Date(2022,0,1,20,0,1)],
            [ "<ШЕЯ>=1000<РАСПИСАНИЕ1>",
              "<РАСПИСАНИЕ1>=<РАСПИСАНИЕ11>",
              "<РАСПИСАНИЕ11>=<УПРАЖНЕНИЯ ШИШОНИНА НА ШЕЮ>;<#1 [СУТ]#>;<упражнения на шею от врача>;<#1 [СУТ]#>",
              "[BEGIN EVAL PARAMETERS]",
              "[END EVAL PARAMETERS]",
            ]
           ],

           /*
           [[new Date(2021,0,1)],
                   [ "<КАЛЕНДАРЬ1>=1000<РАСПИСАНИЕ1>",
              "<РАСПИСАНИЕ1>=<100>;<#1 [СУТ]#>;<110>;<#1 [СУТ]#>",
              "[BEGIN EVAL PARAMETERS]",
              "[END EVAL PARAMETERS]",
            ]
           ],
        [[new Date(2021,0,1)],
          [ "<КАЛЕНДАРЬ2>=1000<РАСПИСАНИЕ2>",
              "<РАСПИСАНИЕ2>=<200>;<#3 [СУТ]#>;<110>",
              "[BEGIN EVAL PARAMETERS]",
              "[END EVAL PARAMETERS]",
            ]
           ],
           */

        ]
        ;
 var Gl_aMetaMetaCalendarSelected = []

 //Массив тренировок
 var Gl_aMetaRithm =
        [

              //========================== УПРАЖНЕНИЯ НА СЛАБЫЕ ЗВЕНЬЯ ЧАСТЬ 1
              [
                [],
                [
                  "<БАЗОВАЯ>="+
                           "<ДЛИННЫЕ РАЗГИБАТЕЛИ ШЕИ>;<#6 [СЕК]#>;"+
                           "<СТОПА>;<#3 [СЕК]#>;"+
                           //"<ВНЕШНИЕ ГОЛЕНИ С РЕЗИНОЙ>;<#6 [СЕК]#>;"+
                           "<РАСТЯЖЕНИЕ ГРУДНЫХ МЫШЦ>;<#10 [СЕК]#>;"+
                           "<РОМБОВИДНАЯ>;<#5 [СЕК]#>;"+
                           "<ПОДКЛЮЧИЧНАЯ>;<#5 [СЕК]#>;"+
                           "<ТЕМЯ>;<#6 [СЕК]#>;"+
                           "<ЖЕВАТЕЛЬНАЯ>;<#6 [СЕК]#>;"+
                           "<ЗАДНЯЯ ПОВЕРХНОСТЬ БЕДРА>;<#6 [СЕК]#>;"+
                           "<ВНУТРЕННИЕ БЕДРА>;<#6 [СЕК]#>;"+
                           //"<ВОССТАНОВЛЕНИЕ СТАБИЛИЗАЦИИ КОЛЕНЕЙ>;<#6 [СЕК]#>;"+
                           "<АСИМЕТРИЧНЫЕ>;<#6 [СЕК]#>;"+
                           "<ОТЛЕТ ПЛЕЧ>;<#6 [СЕК]#>;"+
                           "<ВЕРХ ПЕРИФЕРИЯ>;<#6 [СЕК]#>;"+
                           "<ПРЕСС>;<#6 [СЕК]#>;"+
                           "<СПИНА>;<#6 [СЕК]#>;"+
                           //"<ОСАНКА ДЖЕФФ КАВАЛЬЕР>;<#6 [СЕК]#>;"+
                           "<ОСАНКА ДЖЕФФ КАВАЛЬЕР 2>;<#6 [СЕК]#>;"+
                           //"<МАССАЖ РАССЛАБЛЕНИЕ>;<#6 [СЕК]#>;"+
                           //"<ВАКУУМ ЖИВОТА>;<#4 [СЕК]#>;"+
                           "<Комплекс упражнений на расслабление>;<#4 [СЕК]#>;"+
                           "<ГОРЛО>;",
                  "<КОМАНДА>=<РАЗ>;<#800 #>",
                  "<КОМАНДА ДЕРЖИМ>=<Держим>;<#1000 #>",

                  "<КОМАНДА ВЫДОХ>=<ВЫДОХ ХА>;<#1200 #>",
                  //"<СТОПА>=<Стопа. Стопу на шарик и катать>;<#10 [СЕК]#>;10<КОМАНДА>;<#4 [СЕК]#>;<Сменить ногу>;<#4 [СЕК]#>;10<КОМАНДА>;<#6 [СЕК]#>;<Сидя, стопы на весу - согнуть пальцы - согнуть стопу - разогнуть пальцы-разогнуть стопу>;<#8 [СЕК]#>;10<КОМАНДА>;<#6 [СЕК]#>;<Сидя, стопы на весу - согнуть пальцы - стопа внутрь - разогнуть пальцы-стопа наружу>;<#8 [СЕК]#>;10<КОМАНДА>",
                  "<СТОПА>=<Стопа. Стопу на шарик и катать>;<#10 [СЕК]#>;10<КОМАНДА>;<#4 [СЕК]#>;<Сменить ногу>;<#4 [СЕК]#>;10<КОМАНДА>",
                  "<ДЛИННЫЕ РАЗГИБАТЕЛИ ШЕИ>=<Растяжение левых лестничных мышц. Пальцы прижимают мышцы, наклоны головы вперед-вправо и назад-влево>;<#10 [СЕК]#>;25<КОМАНДА>;<#4 [СЕК]#>;<Растяжение правых лестничных мышц. Пальцы прижимают мышцы, наклоны головы вперед-влево и назад-вправо>;<#10 [СЕК]#>;25<КОМАНДА>;<#6 [СЕК]#>;<Длинные разгибатели шеи. Слабую резинку на турник и на затылок, разгибание , макушка тянется при этом вверх>;<#10 [СЕК]#>;10<КОМАНДА>",
                  "<ВНЕШНИЕ ГОЛЕНИ С РЕЗИНОЙ>=<Внешние голени. Сесть на пол с прямыми ногами, среднюю резинку на ножку кровати и на пальцы левой ноги, сгибание стопы к животу>;<#8 [СЕК]#>;20<КОМАНДА>",
                  "<РАСТЯЖЕНИЕ ГРУДНЫХ МЫШЦ>=<РАСТЯЖЕНИЕ ГРУДНЫХ МЫШЦ. Стоя, ладони на дверные косяки, локти на уровне ушей. Шаг вперед, тянем.>;<# 8[СЕК]#>;10<КОМАНДА>",
                  "<ПОДКЛЮЧИЧНАЯ>=<Подключичная мышца. Соединить ладони рук над головой, подать их немного вперед. Правая ладонь делает движение назад над своим плечом, левая сопротивляется. Повторить в другую сторону>;<#13 [СЕК]#>;20<КОМАНДА>",
                  "<РОМБОВИДНАЯ>=<Ромбовидная мышца. Промять мячиком у стенки область между лопаток>;<#10 [СЕК]#>;45<КОМАНДА>;<#6 [СЕК]#>;<Разведение рук с резинкой, локти выше головы>;<#5 [СЕК]#>;10<КОМАНДА>",
                  "<ТЕМЯ> =<Темя. Напрягать мышцы скальпа>;<#5 [СЕК]#>;15<КОМАНДА>",
                  "<ЖЕВАТЕЛЬНАЯ>=<Жевательные мышцы. Две руки положить на жевательные мышцы в основании челюсти под ушами, раскрывать и закрывать рот, проминая мышцу>;<#12 [СЕК]#>;20<КОМАНДА>;<#5 [СЕК]#>;<Одну руку на низ челюсти, раскрывать и закрывать рот, слегка сопротивляясь рукой>;<#10 [СЕК]#>;10<КОМАНДА>",
                  //"<ЯГОДИЧНАЯ>=<Ягодичные мышцы. Промять двумя мячиками ягодицы сидя на них на полу>;<#12 [СЕК]#>;70<КОМАНДА>;<#6 [СЕК]#>;<Отведение  левой ноги с резиной назад>;<#12 [СЕК]#>;10<КОМАНДА>;<#6 [СЕК]#>;<Отведение  правой ноги с резиной назад>;<#10 [СЕК]#>;10<КОМАНДА>;<#6 [СЕК]#>;<Растяжение. Шаг вперед левой, таз вертикальный, тянем правую поясничную мышцу>;<#8 [СЕК]#>;10<КОМАНДА>;<#6 [СЕК]#>;<Растяжение. Шаг вперед правой, таз вертикальный, тянем левую поясничную мышцу>;<#6 [СЕК]#>;10<КОМАНДА>",
                  "<ЗАДНЯЯ ПОВЕРХНОСТЬ БЕДРА>=<Задняя поверхность бедра. Промять заднюю поверхность правого и левого бедра>;<#10 [СЕК]#>;35<КОМАНДА>;<#6 [СЕК]#>;<Сесть на пол, резинку на столб и под пятки, подтягивать пятки к тазу>;<#12 [СЕК]#>;15<КОМАНДА>",
                  "<ВНУТРЕННИЕ БЕДРА>=<Внутренние бёдра. Сесть на пол, руки на колени, сводить колени сопротивляясь руками>;<#10 [СЕК]#>;25<КОМАНДА>",

                  //"<ПРИСЕДЫ С ОДНОВРЕМЕННЫМИ ОТЖИМАНИЯМИ>=<Приседы с отжиманиями. Взять мощную резинку, перекинуть через спину как для отжиманий. Приседать, одновременно со вставанием вытягивая резинку, с одновременным выдокхом>;<#16 [СЕК]#>;15<КОМАНДА ВЫДОХ>",
                  //"<ВОССТАНОВЛЕНИЕ СТАБИЛИЗАЦИИ КОЛЕНЕЙ>=<Стабилизация коленей. Сесть на пол с прямыми ногами. Спина прямая, руки на колени. Вращение пальцев ног наружу. Колени при этом тоже вращаются.>;<#12 [СЕК]#>;48<КОМАНДА>;<#6 [СЕК]#>;<Вращение пальцев в другую сторону>;<#5 [СЕК]#>;48<КОМАНДА>;<#5 [СЕК]#>;"+
                  //                                       "<Слабую резинку на столб и на правое колено. Резинка тянет колено внутрь. Слегка приседать правой ногой, левая при этом переступает через резинку.>;<#12 [СЕК]#>;10<КОМАНДА>;<#3 [СЕК]#>;"+
                  //                                       "<Повернуться другим боком. Слегка приседать правой ногой, левая не отрывается носком от пола>;<#6 [СЕК]#>;10<КОМАНДА>;<#3 [СЕК]#>;"+
                  //                                       "<Разгибание правой ноги, резинка на столб и на стопу.>;<#6 [СЕК]#>;10<КОМАНДА>;<#3 [СЕК]#>;"+
                  //                                       "<Разгибание левой ноги, резинка на столб и на стопу.>;<#6 [СЕК]#>;10<КОМАНДА>;<#3 [СЕК]#>;"+
                  //                                       "<Встать, стопы чуть шире плеч под прямым углом друг к другу, колени немного согнуты. По команде правую руку вытянуть вперед параллельно правому бедру, одновременно слегка присев правой ногой. Повторить в другую сторону.>;<#12 [СЕК]#>;10<КОМАНДА>",
                  //"<СТАБИЛИЗАЦИЯ ШЕИ>=<Взять правой рукой груз десять килограмм, шраги правой>;<#7 [СЕК] #>;10<КОМАНДА>",
                  //"<СТАБИЛИЗАЦИЯ ШЕИ2>=<Повороты головы вправо, сопротивляться рукой>;<#6 [СЕК] #>;20<КОМАНДА>",
                  //"<СТАБИЛИЗАЦИЯ ШЕИ3>=<Наклоны вправо назад, сопротивляться рукой>;<#6 [СЕК] #>;20<КОМАНДА>",
                  "<СТАБИЛИЗАЦИЯ ШЕИ4>=<Левой рукой держать голову сверху, правой за подбородок. Слегка выгибать шею вправо>;<#6 [СЕК] #>;30<КОМАНДА>",
                  "<АСИМЕТРИЧНЫЕ>=<СТАБИЛИЗАЦИЯ ШЕИ4>;<#3 [СЕК] #>;<ВНЕШНИЕ ГОЛЕНИ С РЕЗИНОЙ>;<#4 [СЕК] #>",
                  "<ТЯГИ К ЖИВОТУ>=<Бицепсы и верх спины. Тяга резинки к животу или к груди.>;<#7 [СЕК]#>;15<КОМАНДА>",
                  "<ОТЖИМАНИЯ>=<Трицепсы и грудь. Отжимания.>;<#7 [СЕК]#>;15<КОМАНДА>",
                  "<ПЛЕЧИ>=<Плечи. Встать на резинку, взять ее руками. Поднимать прямые руки до горизонтали .>;<#7 [СЕК]#>;15<КОМАНДА>",
                  "<АРМРЕСТЛИНГ>=<Руки периферия. Имитация армрестлинга. С резиной. Правая >;<#8 [СЕК]#>;10<КОМАНДА>;<#4 [СЕК]#>;<Левая>;<#4 [СЕК]#>;10<КОМАНДА>",
                  "<ВЫБОР ВЕРХ ПЕРИФЕРИЯ>=[ВЫБОР ИЗ]<АРМРЕСТЛИНГ>:<ОТЖИМАНИЯ>[КАК]1:1",
                  `<ВЕРХ ПЕРИФЕРИЯ>=<ТЯГИ К ЖИВОТУ>;<#5 [СЕК]#>;<ВЫБОР ВЕРХ ПЕРИФЕРИЯ>;<#3 [СЕК]#>;
                  //                   <Подтянуться >;<количество подтягиваний>;< раз>
                                     ;<#7 [СЕК]#>;<ПРЕДПЛЕЧЬЯ>`,
                  "<ПРЕДПЛЕЧЬЯ>=<Предплечья. Сложить ладони перед собой, наклонять их влево вправо  с сопротивлением. Можно положить одну ладонь на на тыльную сторону другой, наклонять вперед назад с сопротивлением. Менять положение по желанию.>;<#10[СЕК]#>;25<КОМАНДА>",
                  //"<ПРЕСС> =<Пресс. Повиснуть на турнике, коленик груди, висеть>;<#7 [СЕК]#>;10<КОМАНДА>",
                  "<ПРЕСС> =<Пресс. Лечь на спину, руки за голову, ноги согнуты в коленях, ступни на полу. Поднимать туловище, тянуть локоть к противоположному колену. Поясница остается прижатой к полу.>;<#7 [СЕК]#>;12<КОМАНДА>",
                  //"<СПИНА> =<Спина. Гиперэкстензии с грузом 5 килограмм.>;<#10 [СЕК]#>;10<КОМАНДА>",
                  `<СПИНА> =<Спина. Лечь на живот, руки вытянуть вперед. Одновременно поднимать руку и противоположную ногу, можно взять гантели>;<#10 [СЕК]#>;12<КОМАНДА>;
                            <С небольшим весом килограмм в пять делать приседы или становую на выбор>;<#7 [СЕК]#>;12<КОМАНДА>;
                            <Шраги с небольшим весом килограмм в пять>;<#7 [СЕК]#>;15<КОМАНДА>;
                  `,
                  "<ОСАНКА ДЖЕФФ КАВАЛЬЕР> =<Осанка. Упражнение от Джеффа Кавальера. Обернуть жгут вокруг живота, вывести его ручк вперед. Взять ручки руками накрест. Развернуть руки - локти вниз, кисти по бокам на уровне плеч. Жгут стягивает кор. Держать>;<#16 [СЕК]#>;3<ЦИКЛ ОСАНКА>",
                  `<ЦИКЛ ОСАНКА> =<Держим. Линия шеи от основания до подзатылка перпендикулярна земле, при этом подзатылочные мышцы расслаблены>;<#7 [СЕК]#>;
                                  <Держим. Мечевидный отросток перпендикулярен земле>;<#5 [СЕК]#>;
                                  <Держим. Слегка напрячь ягодицы, таз должен разогнуться от позвоночника>;<#5 [СЕК]#>;
                                  <Держим. Выпрямить ноги в коленях>;<#5 [СЕК]#>
                                  `,
                  "<ОСАНКА ДЖЕФФ КАВАЛЬЕР 2> =<Осанка 2. Встать, держа перед собой на вытянутых руках слабую резинку. Большие пальцы рук смотрят друг на друга. Разводить руки в стороны, одновременно поворачивая большие пальцы вверх>;<#9 [СЕК]#>;20<КОМАНДА>;<#2 [СЕК]#>;<Делать это упражнение почаще, с небольшой интенсивностью>;",
                  "<МАССАЖ РАССЛАБЛЕНИЕ> =<Расслабление диафрагмы. Ладонями давить под ребра под углом 45 градусов.>;<#5 [СЕК]#>;30<КОМАНДА>",//;<Четырьмя пальцами давить под мечевидный отросток под углом 45 градусов вверх и вбок в разные стороны. Искать болевые точки и держать на них давление.>;<#9 [СЕК]#>;30<КОМАНДА>",
                  "<ВАКУУМ ЖИВОТА> =<Вакуум живота.>;<#5 [СЕК]#>;3<ВАКУУМ ЖИВОТА ЦИКЛ>",
                  "<ВАКУУМ ЖИВОТА ЦИКЛ> =<Три вдоха и выдоха, на третий выдох втянуть живот и держать.>;<#10 [СЕК]#>;20<КОМАНДА ДЕРЖИМ>",
                  "<ГОРЛО> =<И еще почитать, поговорить вслух или поиграть на флейте, или просто понапрягать горло>;<#7 [СЕК]#>;",
                  "<ОТЛЕТ ПЛЕЧ>=<Декомпрессия плечевого сустава Резинку сверху на плечо сверху бицепса. Плечо под 60 градусов вбок и 30 вверх. Второй рукой взять кисть первой, легкие движения кисти к груди, резинка слегка напряжена и оттягивает плечо>;<#9 [СЕК]#>;15<КОМАНДА>;<сменить руку>;<#2 [СЕК]#>;15<КОМАНДА>;",
                  "<Комплекс упражнений на расслабление>=1<цикл расслабление 1>;",
                  "<цикл расслабление 1>=<рассл 1.1.>;<рассл 1.2.>;<рассл 1.3.>;<рассл 1.4.>;<рассл 1.5.>;<рассл 1.6.>;",
                  //Упражнениями на расслабление решается задача быстрого восстановления функций организма после физической нагрузки, повышения работоспособности детей и перевод их из одного эмоционального состояния (возбужденного) в другое (спокойное).                Целесообразно использовать следующие упражнения на расслабление, причём в определенной последовательности:
                  "<рассл 1.1.>=< Потряхивание расслабленными кистями рук, всей рукой, обеими руками. Стряхнули воду с рук>;<#4000#>;25<КОМАНДА>;",
                  "<рассл 1.2.>=< Поочередное потряхивание правой   (левой) расслабленной ногой. Стряхнули  снег с ботинка>;<#4000#>;25<КОМАНДА>;",
                  //Слова учителя, сопровождающие это упражнение, направлены на то, чтобы вызвать мышечное ощущение расслабления в конечностях: «Стряхнули водичку с рук»; «Стряхнули  снег с ботинка».",
                  "<рассл 1.3.>=< Повороты вправо  (влево)  всего корпуса и расслабленных рук (Руки как плети, Как ветви обвивают ствол дерева при ветре).>;<#5000#>;25<КОМАНДА>;",
                  "<рассл 1.4.>=< Семенящий бег на месте, носки не отрывать от пола, руки вдоль туловища. Движения конечностей, туловища расслаблены.>;<#5000#>;25<КОМАНДА>;",
                  "<рассл 1.5.>=< Семенящий  бег с  продвижением    вперед. Вначале дети   медленно  продвигаются в центр круга, затем поворачиваются и двигаются в обратном направлении, расширяя круг.>;<#6000#>;25<КОМАНДА>;",
                  // Возможно использование семенящего бега и в других построениях.
                  "<рассл 1.6.>=< Дыхательное упражнение стоя на месте и в движении с подниманием расслабленных рук в стороны-вверх   (вдох)     и опусканием    их  (бросить) вниз (выдох). После освоения упражнений на расслабление стоя на месте и в движении переходят к освоению упражнений лежа на полу.>;<#7000#>;25<КОМАНДА>;",

                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "<количество подтягиваний>=(1+(new Date()).getMonth())%11",
                  "[END EVAL PARAMETERS]",
                ],
               ],
              //===============
              //================  РАСТЯЖКА
              [
                [],
                [ "<РАСТЯЖКА>=1<ЦИКЛ>",
                  "<ЦИКЛ>=<У0>;<У1>;<У2>;<У3>;<У4>;<У5>;<У6>;<У7>;",
                  "<У0>=<Перед растяжкой необходимо выполнить короткую разминку, подойдет любой комплекс аэробных упражнений. После чего переходите к стретчингу>;<#7 [СЕК]#>;<для улучшения ощущений и качества тренировки, включите приятную, спокойную музыку.>;<#7 [СЕК]#>;<Все упражнения выполняйте без резких движений, оставайтесь в каждой позе несколько минут.>;<#7 [СЕК]#>",
                  "<У1>=<«Собака мордой вверх». Данная поза хорошо растягивает мышцы пресса. Лежа на животе, поставьте руки под плечи. Поднимите верхнюю часть тела и обопритесь на прямые руки. Старайтесь сохранять плечи опущенными. Как можно глубже прогнитесь в грудном отделе.>;<#16 [СЕК]#>;7(<тянем>;<#10 [СЕК]#>)",
                  "<У2>=<«Поза ребенка». Встаньте на четвереньки, колени подальше друг от друга, чтобы хорошо растянуть мышцы бедер. Отведите ягодицы назад, руками тянитесь по полу вперед. Прогнитесь в пояснице, чтобы лучше размять мышцы спины и груди.>;<#9 [СЕК]#>;10(<тянем>;<#10 [СЕК]#>)",
                  "<У3>=<Скручивание лежа. Растяжка косых мышц живота и ягодиц. Перевернитесь на спину, согните одну ногу в колене и перенесите на противоположную сторону пока не коснетесь пола, при желании, противоположной рукой можно аккуратно надавить на колено. Грудную клетку сохраняйте открытой и прижатой к полу.>;<#14 [СЕК]#>;4(<тянем>;<#10 [СЕК]#>);<Поменяйте ноги.>;<#3 [СЕК]#>;4(<тянем>;<#10 [СЕК]#>)",
                  "<У4>=<Поперечная складка вперед. Сядьте ровно и разведите ноги как можно шире. Положите руки перед собой, тянитесь вперед и постарайтесь медленно лечь на пол. Упражнение расслабляет подколенные сухожилия и приводящую мышцу.>;<#9 [СЕК]#>;9(<тянем>;<#10 [СЕК]#>)",
                  "<У5>=<Растяжка трицепсов и плеч. Встаньте ровно и поднимите одну руку вверх, согните ее в локте за головой. Вторую руку оставьте внизу и тоже согните в локте за спиной. Постарайтесь дотянуться одной рукой до другой. Если зацепиться пальцами не получается, воспользуйтесь веревкой или небольшим полотенцем.>;<#15 [СЕК]#>;3(<тянем>;<#10 [СЕК]#>);<Поменяйте руки.>;<#3 [СЕК]#>;3(<тянем>;<#10 [СЕК]#>)",
                  "<У6>=<Растяжка бицепсов. Встаньте прямо, скрепите руки в замок за спиной, так чтобы ладони смотрели вниз. В таком положении постарайтесь поднять руки как можно выше, корпус держите прямо.>;<#9 [СЕК]#>;5(<тянем>;<#10 [СЕК]#>)",
                  "<У7>=<Завершите комплекс упражнений наклонами головы, чтобы растянуть мышцы шеи.Медленно и аккуратно наклоните голову сначала влево, затем вправо, потом вперед и назад.>;<#9 [СЕК]#>;",

                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",
                ],
               ],
              //=================================================
              //================  УПРАЖНЕНИЯ НА ПОЗВОНОЧНИК (ТАЛАМБУМ)
              [
                [],
                [ "<УПРАЖНЕНИЯ НА ПОЗВОНОЧНИК (ТАЛАМБУМ)>=1<ЦИКЛ>",
                  "<ЦИКЛ>=<УПР 1>;<#6 [СЕК]#>;<УПР 2>;<#6 [СЕК]#>;<УПР 3>;<#6 [СЕК]#>;<УПР 4>;<#6 [СЕК]#>;<УПР 5>;<#6 [СЕК]#>;<УПР 6>;<#6 [СЕК]#>;<УПР 7>;<#6 [СЕК]#>;<УПР 8>;<#6 [СЕК]#>;<УПР 9>;<#6 [СЕК]#>;<УПР 10>",
                  "<УПР 1>=<Упражнение один. Лежа на спине, на выдохе согните ноги. колени обхватите руками и притяните к груди.>;<#5 [СЕК]#>;10(3(< вдох>;<#800 #>);3(< выдох согнуть>;<#800 #>);3(< тянем>;<#800 #>));",
                  "<УПР 2>=< Упражнение два. Лежа на спине, на выдохе согните одну ногу, другую - вытяните. Обхватите колено согнутой ноги и притяните его к груди. То же самое проделайте с другой ногой>;<#8 [СЕК]#>;10(3(< вдох>;<#800 #>);3(< выдох правая>;<#800 #>);3(< тянем>;<#800 #>)3(< вдох>;<#800 #>);3(< выдох левая>;<#800 #>);3(< тянем>;<#800 #>));",
                  "<УПР 3>=<Упражнение три. Встаньте на четвереньки, выгните спину, втяните живот, голову наклоните к груди, зафиксируйти позу. Плавно опустите спину, поднимите голову. Не прогибайтесь в пояснице>;<#9 [СЕК]#>;10(3(< вдох>;<#800 #>);3(< выдох выгнуть>;<#800 #>));",
                  `<УПР 4>=<Упражнение четыре. Лежа на спине с вытянутыми вдоль туловища руками и слегка согнутыми ногами. На выдохе положите ноги на пол в правую сторону, при этом верхнюю часть туловища и голову поверните влево.>;<#9 [СЕК]#>;
                           <Позвоночник должен достаточно сильно изогнуться на участке поясничного отдела. Оставайтесь в таком положении не более пяти секунд. На вдохе вернитесь в исходное положение. Повторите в другую сторону.>;<#9 [СЕК]#>;
                             10(3(< вдох>;<#800 #>);3(< выдох направо>;<#800 #>);3(< тянем>;<#800 #>)3(< вдох>;<#800 #>);3(< выдох налево>;<#800 #>);3(< тянем>;<#800 #>));;`,
                  "<УПР 5>=< Упражнение пять. Лежа на спине, под головой подушечка высотой пять семь сантиметров и валик под коленями. Поочередно выпрямляйте ноги, тяните носок.>;<#8 [СЕК]#>;10(<что там сказать то>;<#800 #>);",

                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================
              //===============
              //================  АНТИСИМПАТИЧЕСКИЙ АУТОТРЕНИНГ ПРОТИВ ПА
              [
                [],
                [ "<АНТИСИМПАТИЧЕСКИЙ АУТОТРЕНИНГ ПРОТИВ ПА>=<ЦИКЛ>;",
                  "<ЦИКЛ>=<1>;<2>;<3>;<4>;<5>;<6>;<7>;<8>",
                  "<1>=<аутотренинг направлен на ослабление симпатических импульсов и увеличения парасимпатических для устранения панической атаки>;<#7000 #>;<дышать нужно только животом. можно положить ладонь на грудь и контролировать неподвижность грудной клетки>;<#6000 #>",
                  "<2>=2(<расслабляем мышцы и сосуды кистей рук и ступней. расслабление начинается от почек и почечной артерии, идет в конечности>;<#15000 #>;<расслабляем не забываем дышать животом>;<#15000#>)",
                  "<3>=2(<расслабляем короткие подзатылочные мышцы>;<#15000 #>;<расслабляем не забываем дышать животом>;<#15000#>)",
                  "<4>=2(<расслабляем брови и лоб>;<#15000 #>;<расслабляем,не забываем дышать животом>;<#15000#>)",
                  "<5>=2(<рот медленно наполняется слюной>;<#15000 #>;<продолжаем не забываем дышать животом>;<#15000#>)",
                  "<6>=2(<медленно возбуждается перистальтика толстой кишки>;<#15000 #>;<не забываем дышать животом>;<#15000#>)",
                  "<7>=2(<расслабляем верхнюю часть глазниц и мышцы скальпа>;<#15000 #>;<расслабляем,не забываем дышать животом>;<#15000#>)",
                  "<8>=2(<расслабляем короткие подзатылочные мышцы шеи и пытаемся замедлить сердцебиение. для замедления сердцебиения пытаемся почувствовать удар сердца и задержать его>;<#15000 #>;<расслабляем,не забываем дышать животом>;<#15000#>)",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",

                ],
               ],

              //===============
              //================  БЫСТРОЕ РАССЛАБЛЕНИЕ ШЕИ (МАКСИМ БОНДАРЬ)
              [
                [],
                [ "<БЫСТРОЕ РАССЛАБЛЕНИЕ ШЕИ (МАКСИМ БОНДАРЬ)>=1<ЦИКЛ>",
                  "<ЦИКЛ>=<ПРОМЯТЬ ОБЛАСТЬ C6_C7>;<#6 [СЕК]#>;<БОКОВОЕ РАСТЯЖЕНИЕ ШЕИ>;<#6 [СЕК]#>;<ФРОНТАЛЬНОЕ РАСТЯЖЕНИЕ ШЕИ>;<#6 [СЕК]#>;<РАСТЯЖЕНИЕ ЛЕСТНИЧНЫХ МЫШЦ>",
                  "<КОМАНДА>=<РАЗ>;<#1000 #>",
                  "<КОМАНДА2>=<ТЯНЕМ>;<#1000 #>",
                  "<ПРОМЯТЬ ОБЛАСТЬ C6_C7>=<Промять теннисным или деревянным мячом у стенки область шестого и седьмого позвонков. Проминать до боли>;<#8 [СЕК]#>;30<КОМАНДА>",
                  "<БОКОВОЕ РАСТЯЖЕНИЕ ШЕИ>=<БОКОВОЕ РАСТЯЖЕНИЕ ШЕИ. Правой рукой взять голову сверху, пальцы до левого уха. Левая рука держит шею сзади. Медленно тянуть голову к правому плечу, левая рука тянет мышцы шеи вниз. >;<#14 [СЕК]#>;10<КОМАНДА2>;<#2 [СЕК]#>;<повторить в ту же сторону>;<#2 [СЕК]#>;10<КОМАНДА2>;<#2 [СЕК]#>;<повторить в другую сторону>;<#2 [СЕК]#>;10<КОМАНДА2>;<#2 [СЕК]#>;<повторить в ту же сторону>;<#2 [СЕК]#>;10<КОМАНДА2>",
                  "<ФРОНТАЛЬНОЕ РАСТЯЖЕНИЕ ШЕИ>=<ФРОНТАЛЬНОЕ РАСТЯЖЕНИЕ ШЕИ.Сесть на стул, выдвигаем голову максимально вперед и тянем.>;<#6 [СЕК]#>;10<КОМАНДА>;<#2 [СЕК]#>;<возвращаем голову и тянем ее назад>;<#5 [СЕК]#>;10<КОМАНДА2>",
                  "<РАСТЯЖЕНИЕ ЛЕСТНИЧНЫХ МЫШЦ>=<РАСТЯЖЕНИЕ ЛЕСТНИЧНЫХ МЫШЦ. Правой рукой взять голову сверху, пальцы до левого уха. Левая рука за спиной. Тянуть голову вправо.>;<#7 [СЕК]#>;10<КОМАНДА2>;<#2 [СЕК]#>;<Повторить в другую сторону>;<#3 [СЕК]#>;10<КОМАНДА2>;",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================
              //================  МАССАЖ ШЕИ (МАКСИМ БОНДАРЬ)
              [
                [],
                [ "<МАССАЖ ШЕИ (МАКСИМ БОНДАРЬ)>=<Массаж выполняется сидя, должна быть возможность упереться лбом в кулак или в стол>;<#8 [СЕК]#>;1<ЦИКЛ>",
                  "<ЦИКЛ>=<ЛЕГКИЙ РАЗОГРЕВ РАЗГИБАТЕЛЕЙ>;<#6 [СЕК]#>;<ГЛУБОКИЙ МАССАЖ РАЗГИБАТЕЛЕЙ>;<#6 [СЕК]#>;<ГЛУБОКИЙ МАССАЖ ПОДЗАТЫЛОЧНЫХ>;<#6 [СЕК]#>;<ГЛУБОКИЙ МАССАЖ ТРАПЕЦИЙ>;<#6 [СЕК]#>;<РАСТЯЖЕНИЕ ЛЕСТНИЧНЫХ>;<#6 [СЕК]#>;<ВРАЩЕНИЯ>",
                  "<КОМАНДА>=<РАЗ>;<#1000 #>",
                  "<КОМАНДА2>=<ТЯНЕМ>;<#1000 #>",
                  "<ЛЕГКИЙ РАЗОГРЕВ РАЗГИБАТЕЛЕЙ>=<Двумя теплыми руками  легкие растирания шеи сзади. Елочкой>;<#8 [СЕК]#>;40<КОМАНДА>",
                  "<ГЛУБОКИЙ МАССАЖ РАЗГИБАТЕЛЕЙ>=<Те же действия, но медленней и глубже>;<#8 [СЕК]#>;50<КОМАНДА>;",
                  "<ГЛУБОКИЙ МАССАЖ ПОДЗАТЫЛОЧНЫХ>=<Упереть голову лбом в кулак или о стол. Медленные глубокие проминающие движения подзатылочных мышц - от середины до сосцевидного отростка за ухом, в обе стороны>;<#10 [СЕК]#>;40<КОМАНДА>",
                  "<ГЛУБОКИЙ МАССАЖ ТРАПЕЦИЙ>=<Сесть прямо. Взять трапеции руками. Медленные глубокие проминания обоих трапеций одновременно. Задерживать давление на триггерных точках у концов ключиц.>;<#10 [СЕК]#>;40<КОМАНДА>",
                  "<РАСТЯЖЕНИЕ ЛЕСТНИЧНЫХ>=<РАСТЯЖЕНИЕ ЛЕСТНИЧНЫХ МЫШЦ. Правой рукой взять голову сверху, пальцы до левого уха. Левая рука за спиной. Медленно тянуть голову вправо.>;<#7 [СЕК]#>;15<КОМАНДА2>;<#2 [СЕК]#>;<Повторить в другую сторону>;<#3 [СЕК]#>;15<КОМАНДА2>;",
                  "<ВРАЩЕНИЯ>=<Медленно и осторожно вращать голову влево-назад и обратно>;<#6000 #>;20<КОМАНДА>",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================


             //========================== УПРАЖНЕНИЯ ШИШОНИНА НА ШЕЮ
              [
                [],
                [
                  "<УПРАЖНЕНИЯ ШИШОНИНА НА ШЕЮ>=<Перед тренировкой снизить давление>;<#6 [СЕК]#>;<РАЗМИНКА>;<#6 [СЕК]#>;<ФАКИР>;<#6 [СЕК]#>;<ГУСЬ>;<#6 [СЕК]#>;<РАМКА>;<#6 [СЕК]#>;<ДЕРЕВО>;<#6 [СЕК]#>;<ВЗГЛЯД В НЕБО>",
                  "<КОМАНДА>=<РАЗ>;<#900 #>",
                  "<КОМАНДА ОТДЫХ>=<ОТДЫХ>;<#1000 #>",
                  "<РАЗМИНКА>=<Разминка с гантелями. Три упражнения сидя на стуле. Сесть ближе к краю не опираясь на спинку. Спина прямая,лицо смотрит вперед.>;<#8 [СЕК] #>;<Количество повторений - столько раз, сколько хватит сил. Мыщц должны болеть и гореть. Можно подобрать веса чтобы делать около тридцати раз>;<#10 [СЕК]#>;<РАЗМИНКА1>;<#14 [СЕК]#>;<РАЗМИНКА2>;<#14 [СЕК]#>;<РАЗМИНКА3>",
                  "<РАЗМИНКА1>=<Упражнение один. Голову выдвинуть вперед. По команде поднять руки в стороны до горизонтали. Опустить руки в исходное положение.>;<#8 [СЕК] #>;60<КОМАНДА>;<#4 [СЕК]#>;50<КОМАНДА ОТДЫХ>",
                  "<РАЗМИНКА2>=<Упражнение два. Голову выдвинуть вперед. Правое плечо повернуть вперед. По команде поднять руки в стороны до горизонтали. Опустить руки в исходное положение. Вернуть плечо в исходное положение>;<#9 [СЕК] #>;50<КОМАНДА>;<#4 [СЕК]#>;55<КОМАНДА ОТДЫХ>;<Голову выдвинуть вперед. Левое плечо повернуть вперед. По команде поднять руки в стороны до  горизонтали.  Опустить руки в исходное положение. Вернуть плечо в исходное положение>;<#9 [СЕК] #>;50<КОМАНДА>;<#4 [СЕК]#>;50<КОМАНДА ОТДЫХ>",
                  "<РАЗМИНКА3>=<Упражнение три. Голову выдвинуть вперед. По команде поднять руки вперед перед собой до горизонтали. Опустить руки в исходное положение. Вернуть голову назад в исходное положение>;<#9 [СЕК] #>;50<КОМАНДА>;<#4 [СЕК]#>;50<КОМАНДА ОТДЫХ>",
                  "<2ЦИКЛ>=<ВЛЕВО>;<#12 [СЕК]#>;<ВЕРНУТЬ ГОЛОВУ В ИСХОДНОЕ ПОЛОЖЕНИЕ>;<#1 [СЕК]#>;<ВПРАВО>;<#12 [СЕК]#>;<ВЕРНУТЬ ГОЛОВУ В ИСХОДНОЕ ПОЛОЖЕНИЕ>;<#1 [СЕК]#>;25<КОМАНДА ОТДЫХ>",
                  "<21ЦИКЛ>=<ВЛЕВО>;<#15 [СЕК]#>;<ВЕРНУТЬ ГОЛОВУ В ИСХОДНОЕ ПОЛОЖЕНИЕ>;<#1 [СЕК]#>;<ВПРАВО>;<#15 [СЕК]#>;<ВЕРНУТЬ ГОЛОВУ В ИСХОДНОЕ ПОЛОЖЕНИЕ>;<#1 [СЕК]#>;25<КОМАНДА ОТДЫХ>",
                  "<1ЦИКЛ>=<Поднять>;<#2 [СЕК]#>;<Держать>;<#8 [СЕК]#>;<Опустить>;<#2 [СЕК]#>;25<КОМАНДА ОТДЫХ>",
                  "<ФАКИР>=<Факир.Сидя прямо на краю стула, не облокачиваясь, руки опущены.>;<#7 [СЕК]#>;<По команде свести ладони над головой и сильно надавить ими друг на друга, локти в стороны. Поворачиваем голову влево. Держим пять- пятнадцаь секунд и по команде делаем в обратном порядке.Вы должны почувствовать напряжение в грудном отделе и под затылком. Обязательно сконцентрируйтесь на этих ощущениях, чтобы добиться от упражнения максимального результата>;<#15 [СЕК]#>;7<2ЦИКЛ>",
                  "<ГУСЬ>=<Гусь. Основное упражнение. Выполняется один раз. Сидя прямо на краю стула, не облокачиваясь, руки опущены. По команде вынести голову вперед, взгляд вперед.>;<#8 [СЕК]#>;< Затем наклоняем голову вправо. Затем тянемся носом к правой подмышке и задерживаемся в таком положении. По команде возвращаем голову в исходное положение строго в обратном порядке. Повторяем в другую сторону.>;<#15 [СЕК]#>;<2ЦИКЛ>",
                  "<РАМКА>=<Рамка. Выполняется один раз. Сидя прямо на краю стула, не облокачиваясь, руки опущены. По команде поднимаем левую руку и упираем в правое плечо параллельно полу.>;<#9 [СЕК]#>;< Поворачиваем голову влево. Упираемся подбородком в левое плечо и задерживаемся в таком положении. Концентрируемся на лестничных мышцах. По команде возвращаем голову, затем руку в исходное положение. Повторяем в другую сторону.Вы должны почувствовать напряжение в лестничных мышцах и обязательно сконцентрироваться на этом ощущении, чтобы добиться от упражнения желаемого результата.>;<#21 [СЕК]#>;<2ЦИКЛ>",
                  "<ДЕРЕВО>=<Дерево. Для проработки всех позвонков. Сидя прямо на краю стула, не облокачиваясь, руки опущены.>;<#8 [СЕК]#>;<По команде поднимаем руки вверх. Ладони смотрят вверх, кончики пальцев рук касаются друг друга.>;<#7 [СЕК]#>;<Максимально выдвинуть голову вперед, не наклонять лицо. Почуствовать напряжение всех позвонков. Удерживать 10 - 15 секунд. По команде вернуться в исходное положение движениями в обратном порядке.Вы должны почувствовать напряжение в позвоночнике и обязательно сконцентрироваться на нем, чтобы добиться проработки каждого позвонка.>;<#17 [СЕК]#>;6<1ЦИКЛ>",
                  "<ВЗГЛЯД В НЕБО>=<Взгляд в небо. Подзатылочные мышцы, устранение нестабильности первого позвонка.>;<#4 [СЕК]#>;< Выполняется один раз. Сидя прямо на краю стула, не облокачиваясь, руки опущены. По команде повернуть голову  вправо до упора.>;<#10 [СЕК]#>;< Затем пытаемся поднять голову вверх. Удерживаем 10 15 секунд. Почуствовать напряжение подзатылочной области.>;<#7 [СЕК]#>;< По команде расслабляемся и повторяем влево - поворот, поднимаем вверх и держим. По команде возвращаемся в исходное положение строго в обратном порядке.  Вы должны почувствовать напряжение в подзатылочной области и обязательно сконцентрироваться на нем, чтобы добиться проработки подзатылочной группы мышц>;<#25 [СЕК]#>;<21ЦИКЛ>",
                  "// ",
                  "// прямо на краю стула, не облокачиваясь, руки опущены.   - голову прямо, затем руки в стороны и опускаем вниз",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",
                ],
               ],
              //================
              //================  ХОККЕЙ - РУКИ
              [
                [],
                [ "<ХОККЕЙ - РУКИ>=1<ЦИКЛ>",
                  "<ЦИКЛ>=400(<ДЕЙСТВИЕ ДРИБЛИНГА>;<#1500 #>)",
                  "<ДЕЙСТВИЕ ДРИБЛИНГА>=[ВЫБОР ИЗ]<Мяч вправо>:<Мяч влево>:<Мяч вперед>:<Мяч назад>[КАК]1:1:1:1",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",
                ],
               ],
              //================
               //================  ХОККЕЙ - НОГИ
              [
                [],
                [ "<ХОККЕЙ - НОГИ>=1<ЦИКЛ>",
                  `<ЦИКЛ>=<#7000 #>;<по команде взгляд смотреть примерно на верхнюю часть борта, в направлении команды. Но при этом шайба должна быть в поле периферического зрения>;
                          <#5000 #>;<без шайбы, клюшка в руках>;<#4000 #>;30(<взгляд>;<НАПРАВЛЕНИЕ ВЗГЛЯДА>;<ДЕЙСТВИЕ>;<НАПРАВЛЕНИЕ>;<#5500 #>);
                          <продолжить с шайбой>;<#5000 #>;120(<взгляд>;<НАПРАВЛЕНИЕ ВЗГЛЯДА>;<ДЕЙСТВИЕ>;<НАПРАВЛЕНИЕ>;<#5500 #>);
                          <далее катание на ребрах. змейка на двух ногах, внешние ребра на одной ноге, внутренние ребра на одной ноге. катание на одной ноге с места. затем то же самое спиной вперед.>
                  `,
                  "<ДЕЙСТВИЕ>=[ВЫБОР ИЗ]<Вираж>:<Улитка>:<Циркуль>[КАК]2:2:1",
                  "<НАПРАВЛЕНИЕ>=[ВЫБОР ИЗ]<вправо>:<влево>[КАК]1:1",
                  "<НАПРАВЛЕНИЕ ВЗГЛЯДА>=[ВЫБОР ИЗ]<вперед>:<вправо>:<влево>[КАК]1:1:1",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",
                ],
               ],
              //================

              //================  ХОККЕЙ - ОДНОВРЕМЕННО РУКИ И НОГИ
              [
                [],
                [ "<ХОККЕЙ - ОДНОВРЕМЕННО РУКИ И НОГИ>=<ХОККЕЙ - НОГИ> [ОДНОВРЕМЕННО С] <ХОККЕЙ - РУКИ>",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",
                ],
               ],
              //================
               /**/
              //========================== СПИНА ДЖЕФФ КАВАЛЬЕР
              [
                [],
                [ "<СПИНА ДЖЕФФ КАВАЛЬЕР>=1<ЦИКЛ>",
                  "<ЦИКЛ>=<ГИПЕРЭКСТЕНЗИИ С РЕЗИНОЙ>;<#6 [СЕК]#>;30<КОМАНДА ОТДЫХ>;<ТЯГА СВЕРХУ>;<#6 [СЕК]#>;30<КОМАНДА ОТДЫХ>;<ГИПЕРЭКСТЕНЗИИ С W>;<#6 [СЕК]#>;30<КОМАНДА ОТДЫХ>;<ГОРИЗОНТАЛЬНАЯ ТЯГА В НАКЛОНЕ>;<#6 [СЕК]#>;30<КОМАНДА ОТДЫХ>;<ГИПЕРЭКСТЕНЗИИ ПРОСТЫЕ>;<#6 [СЕК]#>;30<КОМАНДА ОТДЫХ>;<БОКОВАЯ ТЯГА ОДНОЙ РУКОЙ>",
                  "<КОМАНДА>=<РАЗ>;<#1000 #>",
                  "<КОМАНДА2>=<РАЗ>;<#1000 #>;<ДВА>;<#1000 #>",
                  "<КОМАНДА ОТДЫХ>=<Отдых>;<#1000 #>",
                  "<ГИПЕРЭКСТЕНЗИИ С РЕЗИНОЙ>=<Гиперэкстензии с одновременным разведением рук с резиной>;<#6 [СЕК]#>;15<КОМАНДА>",
                  "<ГИПЕРЭКСТЕНЗИИ С W>=<Гиперэкстензии. В верхней точке развести руки с гантелями. Локти согнуты, кулаки на уровне ушей. буквой дубль вэ.>;<#6 [СЕК]#>;15<КОМАНДА>",
                  "<ГИПЕРЭКСТЕНЗИИ ПРОСТЫЕ>=<Гиперэкстензии>;<#6 [СЕК]#>;15<КОМАНДА>",
                  "<ТЯГА СВЕРХУ>=<Тяга резины двумя руками сверху вниз. Руки в плоскости туловища>;<#6 [СЕК]#>;15<КОМАНДА>",
                  "<ГОРИЗОНТАЛЬНАЯ ТЯГА В НАКЛОНЕ>=<две резинки закреплены на уровне коленей. Наклониться, взять резинки, руки вытянуты. Подтягивать руки к плечам.>;<#14 [СЕК]#>;15<КОМАНДА>",
                  "<БОКОВАЯ ТЯГА ОДНОЙ РУКОЙ>=<Резинка закреплена на произвольной высоте. Взять ее одной вытянутой рукой, спина прямая, ноги расставлены вперед назад. .>;<#14 [СЕК]#>;<Тянуть руку к поясу, по желанию с разворотом корпуса. Затем переставить ноги и повторить тягу другой рукой в другую сторону >;<#5 [СЕК]#>;26<КОМАНДА2>",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================
              //========================== ИНТЕНСИВ ЖИРОСЖИГАТЕЛЬ 6 МИН ДЖЕФФ КАВАЛЬЕР
              [
                [],
                [ `<ИНТЕНСИВ ЖИРОСЖИГАТЕЛЬ 6 МИН ДЖЕФФ КАВАЛЬЕР>=<Интенсив жиросжигатель. Тренировка состоит из трех сетов, в каждом из которых до трех упражнений разного уровня сложности. Для настройки уровня сложности нужно задать параметр - УРОВЕНЬ СЛОЖНОСТИ ОТ 0 ДО 1>;<#16 [СЕК]#>;
                                                                 1<ЦИКЛ>`,
                  "<ЦИКЛ>=<СЕТ 1>;<#6 [СЕК]#>;<СЕТ 2>;<#6 [СЕК]#>;<СЕТ 3>;<#6 [СЕК]#>;",
                  "<КОМАНДА>=<РАЗ>;<#1000 #>",
                  "<СЕТ 1>=<СЕТ 1 ЛЕГКИЙ>;<#16 [СЕК]#>;<КОЛИЧЕСТВО ЛЕГКИХ><КОМАНДА>;<#3000 #>;<СЕТ 1 СРЕДНИЙ>;<#16 [СЕК]#>;<КОЛИЧЕСТВО СРЕДНИХ><КОМАНДА>;<#3000 #>;<СЕТ 1 СЛОЖНЫЙ>;<#16 [СЕК]#>;<КОЛИЧЕСТВО СЛОЖНЫХ><КОМАНДА>;<#3000 #>",
                  "<СЕТ 2>=<СЕТ 2 ЛЕГКИЙ>;<#16 [СЕК]#>;<КОЛИЧЕСТВО ЛЕГКИХ><КОМАНДА>;<#3000 #>;<СЕТ 2 СРЕДНИЙ>;<#16 [СЕК]#>;<КОЛИЧЕСТВО СРЕДНИХ><КОМАНДА>;<#3000 #>;<СЕТ 2 СЛОЖНЫЙ>;<#16 [СЕК]#>;<КОЛИЧЕСТВО СЛОЖНЫХ><КОМАНДА>;<#3000 #>",
                  "<СЕТ 3>=<СЕТ 3 ЛЕГКИЙ>;<#16 [СЕК]#>;<КОЛИЧЕСТВО ЛЕГКИХ><КОМАНДА>;<#3000 #>;<СЕТ 3 СРЕДНИЙ>;<#16 [СЕК]#>;<КОЛИЧЕСТВО СРЕДНИХ><КОМАНДА>;<#3000 #>;<СЕТ 3 СЛОЖНЫЙ>;<#16 [СЕК]#>;<КОЛИЧЕСТВО СЛОЖНЫХ><КОМАНДА>;<#3000 #>",
                  "<СЕТ 1 ЛЕГКИЙ>=<Встать на корточки, руки на полу. Поочередно отшагнуть назад правой и левой ногой. Поочередно вернуть ноги в исходное положение. Повторять цикл.>;<#8 [СЕК] #>",
                  "<СЕТ 1 СРЕДНИЙ>=<Из приседа прыжко перейти в положение для отжиманий. Прыжком вернуться в присед. Повторять цикл.>;<#8 [СЕК] #>",
                  `<СЕТ 1 СЛОЖНЫЙ>=<1. В позе для отжиманий прыжком широко расставить руки и ноги
                                    2. Прыжком вернуться в позу для отжиманий
                                    3. Прыжком перейти в присед
                                    4. Подпрыгнуть вверх
                                    5. Поставить руки на пол и прыжком перейти в позу для отжиманий. Повторять цикл.>;<#14 [СЕК] #>
                  `,
                  "<СЕТ 2 ЛЕГКИЙ>=<Скалолаз.В планке на прямых руках поочередно отталкиваться ногами.>;<#8 [СЕК] #>",
                  "<СЕТ 2 СРЕДНИЙ>=<БОКОВЫЕ УДАРЫ. На корточках с опорой на руки. Поднять правую руку, одновременно произведя под ней удар левой ногой. Повторить в другую сторону. Повторять цикл.>;<#12 [СЕК] #>",
                  "<СЕТ 2 СЛОЖНЫЙ>=<Скалолаз с прыжком. После одного одного цикла скалолаза прыгнуть ногами вверх, при этом руки остаются на земле. Повторять цикл.>;<#12 [СЕК] #>",
                  "<СЕТ 3 ЛЕГКИЙ>=<Стоя делать выпады прыжками, меняя ноги. Руки согнуты в локтях, синхронно поднимаются и опускаются>;<#9 [СЕК] #>",
                  "<СЕТ 3 СРЕДНИЙ>=<Стоя сделать два выпада прыжками, затем из позы на одном колене прыгнуть влево затем вправо, не меня положение ног. Повторять цикл.>;<#12 [СЕК] #>",
                  "<СЕТ 3 СЛОЖНЫЙ>=<Подпрыгнуть высоко вверх, приземлиться в выпад. Сделать симметричный выпад и прыжком вернуться в позу стоя. Повторить в другую сторону. Повторять цикл.>;<#12 [СЕК] #>",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "<УРОВЕНЬ СЛОЖНОСТИ ОТ 0 ДО 1>=0.3",
                  "<КОЛИЧЕСТВО ЛЕГКИХ>=Math.floor((1-<УРОВЕНЬ СЛОЖНОСТИ ОТ 0 ДО 1>)*120/2)",
                  "<КОЛИЧЕСТВО СРЕДНИХ>=Math.floor((1-<УРОВЕНЬ СЛОЖНОСТИ ОТ 0 ДО 1>)*120/2)",
                  "<КОЛИЧЕСТВО СЛОЖНЫХ>=Math.floor(<УРОВЕНЬ СЛОЖНОСТИ ОТ 0 ДО 1>*120/2)",
                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================
              //================  КОМНАТНАЯ ТРЕНИРОВКА БЕЗ ЭКИПИРОВКИ (ДИКИЙ ЛОСЬ)
              [
                [],
                [ "<КОМНАТНАЯ ТРЕНИРОВКА БЕЗ ЭКИПИРОВКИ 10 МИН (ДИКИЙ ЛОСЬ)>=1<ЦИКЛ>",
                  "<ЦИКЛ>=<СКЛАДКА-ПРИСЕДАНИЕ>;<#6 [СЕК]#>;<ПОДЪЕМЫ В ПЛАНКЕ>;<#6 [СЕК]#>;<ПОЛУБЕРПИ С ХЛОПКАМИ ПО ПЛЕЧАМ>;<#6 [СЕК]#>;<СКЛАДКА>;<#6 [СЕК]#>;<ПЛАНКА СУПЕРМЕН>;<#6 [СЕК]#>;<СКАЛОЛАЗ>;<#6 [СЕК]#>;<ОТЖИМАНИЯ НА КУЛАКАХ>;<#6 [СЕК]#>;<ПОДЪЕМЫ С КОЛЕН В ПОЛУПРИСЕД>;<#6 [СЕК]#>;<ШИРОКИЕ ОТЖИМАНИЯ>;<#6 [СЕК]#>;<БОКОВАЯ ПЛАНКА ЛЕВАЯ>;<#6 [СЕК]#>;<ПЛОВЕЦ>;<#6 [СЕК]#>;<БОКОВАЯ ПЛАНКА ПРАВАЯ>;<#6 [СЕК]#>;<АЛМАЗНЫЕ ОТЖИМАНИЯ>;<#6 [СЕК]#>;<ХОДЬБА ГУСЬКОМ>;<#6 [СЕК]#>;<РУССКИЕ СКРУЧИВАНИЯ>;<#6 [СЕК]#>;<ОТЖИМАНИЯ ЛУЧНИК>;<#6 [СЕК]#>;<ПРЫЖКИ ЛЯГУШКА>;<#6 [СЕК]#>;<КОРОТКИЕ ПРЫЖКИ>;<#6 [СЕК]#>;<ОТЖИМАНИЯ КОБРА>;<#6 [СЕК]#>;<БОКОВЫЕ УДАРЫ>",
                  "<КОМАНДА>=<РАЗ>;<#650 #>",
                  "<СКЛАДКА-ПРИСЕДАНИЕ>=<СКЛАДКА-ПРИСЕДАНИЕ. Стоя наклониться, выпрямиться, присесть, выпрямиться >;<#4000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ПОДЪЕМЫ В ПЛАНКЕ>=<ПОДЪЕМЫ В ПЛАНКЕ. В планке на локтях. Подняться на правую руку, затем на левую, затем на правый локоть, и на левый. Повторять.>;<#4000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ПОЛУБЕРПИ С ХЛОПКАМИ ПО ПЛЕЧАМ>=<ПОЛУБЕРПИ С ХЛОПКАМИ ПО ПЛЕЧАМ. Встать, опуститься на корточки, прыгнуть в берпи. Затем дотронуться правой рукой до левого плеча, затем повторить левой. Вернуться на корточки, встать. Повторять.>;<#7000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<СКЛАДКА>=<СКЛАДКА. Сесть на пол с прямыми ногами, оторвать пятки от пола. Прижимать согнутые колени к груди.>;<#4000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ПЛАНКА СУПЕРМЕН>=<ПЛАНКА СУПЕРМЕН. В планке на локтях. Вытянуть правую руку и левую ногу, затем повторить с противоположными. Повторять.>;<#4000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<СКАЛОЛАЗ>=<СКАЛОЛАЗ. В планке на прямых руках поочередно отталкиваться ногами>;<#3000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ОТЖИМАНИЯ НА КУЛАКАХ>=<ОТЖИМАНИЯ НА КУЛАКАХ.>;<#2000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ПОДЪЕМЫ С КОЛЕН В ПОЛУПРИСЕД>=<ПОДЪЕМЫ С КОЛЕН В ПОЛУПРИСЕД. В полуприседе опуститься на одно, затем на оба колена. Затем встать на одну и затем на обе ноги в полуприсед. Повторять.>;<#5000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ШИРОКИЕ ОТЖИМАНИЯ>=<ШИРОКИЕ ОТЖИМАНИЯ.>;<#2000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<БОКОВАЯ ПЛАНКА ЛЕВАЯ>=<БОКОВАЯ ПЛАНКА ЛЕВАЯ. В левой планке на локте или прямой руке соединять правый локоть и правое колено>;<#4000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ПЛОВЕЦ>=<ПЛОВЕЦ. Лечь на спину, оторвать пятки от пола, поочередно невысоко поднимать и опускать прямые ноги>;<#4000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<БОКОВАЯ ПЛАНКА ПРАВАЯ>=<БОКОВАЯ ПЛАНКА ПРАВАЯ. В правой планке на локте или прямой руке соединять левый локоть и левое колено>;<#4000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<АЛМАЗНЫЕ ОТЖИМАНИЯ>=<АЛМАЗНЫЕ ОТЖИМАНИЯ. Отжимания, ладони расположены вплотную друг к другу>;<#3000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ХОДЬБА ГУСЬКОМ>=<ХОДЬБА ГУСЬКОМ. Руки за голову, ходить на корточках вперед-назад>;<#3000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<РУССКИЕ СКРУЧИВАНИЯ>=<РУССКИЕ СКРУЧИВАНИЯ. Сесть на пол, ноги прямые, оторвать пятки от пола. Скручивать ноги в одну сторону, а плечи в другую, чередовать стороны.>;<#5000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ОТЖИМАНИЯ ЛУЧНИК>=<ОТЖИМАНИЯ ЛУЧНИК. Широко расставить руки для отжиманий, переносить вес поочередно к правой и левой ладони>;<#4000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ПРЫЖКИ ЛЯГУШКА>=<ПРЫЖКИ ЛЯГУШКА. Встать на корточки с опорой на руки, отпрыгивать ногами и возвращаться в исходное положение>;<#4000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<КОРОТКИЕ ПРЫЖКИ>=<КОРОТКИЕ ПРЫЖКИ. Руки на голову, прыжки на корточках>;<#3000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<ОТЖИМАНИЯ КОБРА>=<ОТЖИМАНИЯ КОБРА.  Волнообразные отжимания вверх вниз и вперед назад>;<#4000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "<БОКОВЫЕ УДАРЫ>=<БОКОВЫЕ УДАРЫ. На корточках с опорой на руки. Поднять правую руку, одновременно произведя под ней удар левой ногой. Повторить в другую сторону>;<#5000 #>;<КОЛ-ВО УПРОВ><КОМАНДА>;",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "<КОЛ-ВО УПРОВ>=30",
                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================

              //========================== КВАДРАТНОЕ ДЫХАНИЕ
              [
                [],
                [
                  "<КВАДРАТНОЕ ДЫХАНИЕ>=30<ЦИКЛ>",
                  "<ЦИКЛ>=<ПОВТОРЕНИЙ СЛОВА><_ВДОХ>;<ПОВТОРЕНИЙ СЛОВА><_ЗАДЕРЖКА>;<ПОВТОРЕНИЙ СЛОВА><_ВЫДОХ>;<ПОВТОРЕНИЙ СЛОВА><_ЗАДЕРЖКА>",
                  "<_ВДОХ>=<вдох>;<#<ПРОМЕЖУТОК МЕЖДУ СЛОВАМИ МС>#>",
                  "<_ВЫДОХ>=<выдох>;<#<ПРОМЕЖУТОК МЕЖДУ СЛОВАМИ МС>#>",
                  "<_ЗАДЕРЖКА>=<задержка>;<#<ПРОМЕЖУТОК МЕЖДУ СЛОВАМИ МС>#>",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "<ПРОМЕЖУТОК МЕЖДУ СЛОВАМИ МС>=1000",
                  "<ПОВТОРЕНИЙ СЛОВА>=3",
                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================
               //========================== НЕЗАМЕТНЫЕ ДВИЖЕНИЯ
              [
                [],
                [
                  "<НЕЗАМЕТНЫЕ ДВИЖЕНИЯ>=<#2000 #>;<ГЛАЗА>;<ТЕМЯ>;<ЖЕВАТЕЛЬНЫЕ>;<ГОРЛО>;<ШЕЯ_ДА>;<ШЕЯ_НЕТ>;<ПЛЕЧИ>;<ПРЕДПЛЕЧЬЯ>;<СПИНА>;<ПРЕСС>;<БЕДРА>;<СТУПНИ>;",
                  "<РАЗ_ТЕКСТ>=<РАЗ>;<#800 #>;",
                  "<ГЛАЗА>=<ГЛАЗА_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<ГЛАЗА_ТЕКСТ>=<Закрыть глаза. Напрягать и расслаблять веки>;<#3000#>;",
                  "<ТЕМЯ> =<Темя. Напрягать мышцы скальпа>;<#5 [СЕК]#>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<ЖЕВАТЕЛЬНЫЕ>=<ЖЕВАТЕЛЬНЫЕ_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>;",
                  "<ЖЕВАТЕЛЬНЫЕ_ТЕКСТ>=<Напрягать и расслаблять жевательные мышцы>;<#3000#>;",
                  "<ГОРЛО>=<ГОРЛО_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<ГОРЛО_ТЕКСТ>=<Незаметные напряжения и расслабления глотки>;<#3000#>",
                  "<ШЕЯ_ДА>=<ШЕЯ_ДА_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<ШЕЯ_ДА_ТЕКСТ>=<Незаметные кивки вперед-назад без напряжения>;<#3000#>",
                  "<ШЕЯ_НЕТ>=<ШЕЯ_НЕТ_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<ШЕЯ_НЕТ_ТЕКСТ>=<Незаметные повороты головы вправо и влево без напряжения>;<#3000#>",
                  "<ПЛЕЧИ>=<ПЛЕЧИ_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<ПЛЕЧИ_ТЕКСТ>=<Незаметные напряжения и расслабления плеч, бицепсов, трицепсов>;<#3000#>",
                  "<ПРЕДПЛЕЧЬЯ>=<ПРЕДПЛЕЧЬЯ_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<ПРЕДПЛЕЧЬЯ_ТЕКСТ>=<Незаметные напряжения и расслабления предплечий и кистей>;<#3000#>",
                  "<СПИНА>=<СПИНА_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<СПИНА_ТЕКСТ>=<Незаметные напряжения и расслабления спины>;<#3000#>",
                  "<ПРЕСС>=<ПРЕСС_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<ПРЕСС_ТЕКСТ>=<Незаметные напряжения и расслабления живота>;<#3000#>",
                  "<БЕДРА>=<БЕДРА_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<БЕДРА_ТЕКСТ>=<Незаметные напряжения и расслабления бедер и ягодиц>;<#3000#>",
                  "<СТУПНИ>=<СТУПНИ_ТЕКСТ>;<ЧИСЛО ПОВТОРЕНИЙ><РАЗ_ТЕКСТ>",
                  "<СТУПНИ_ТЕКСТ>=<Незаметные напряжения и расслабления икр и ступней>;<#3000#>",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "<ЧИСЛО ПОВТОРЕНИЙ>=30",
                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================
              //========================== УПРАЖНЕНИЯ НА ШЕЮ 1 (ТАЛАМБУМ)
              [
                [],
                [
                  "<УПРАЖНЕНИЯ НА ШЕЮ>=<N1>;<N2>;<N3>;<N4>;<N5>;<N6>;<N7>;<N8>;<N9>;<N10>;<N11>;<N12>;//УПРАЖНЕНИЯ НА ШЕЮ 1 (ТАЛАМБУМ)",
                  "<N1>=<N1NAZV>;<#5 [СЕК]#>;10<N1DEYSTV>",
                  "<N1NAZV>=<Упражнение один, Сгибание шеи>",
                  "<N1DEYSTV>=3<vdoh>;3<vidohsogn>;3<tanem>",
                  "<vdoh>=<Вдох>;<#800 [МСЕК]#>",
                  "<vidohsogn>=<Выдох согнуть>;<#800 [МСЕК]#>",
                  "<tanem>=<Тянем>;<#800 [МСЕК]#>",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================
              //========================== Им медл
              [
                [],
                [
                  "<ИМ>=<#6000 #>;<да да нет нет>;<#2000 #>;20<ЦИКЛ>;<#7000 #>;<засыпание>;",
                  "<ЦИКЛ>=<#1000 #>;8<КОМАНДА1>;10<КОМАНДА2>;",
                  "<КОМАНДА1>=<о>;<#1000 #>",
                  "<КОМАНДА2>=< >;<#1000 #>",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================
              //========================== Умножения
              [
                [],
                [
                  "<УМНОЖЕНИЯ>=<#6000 #>;10<ЦИКЛ>;",
                  "<ЦИКЛ>=<ЧИСЛО1>;<ДЕЙСТВИЕ>;<ЧИСЛО1>;<#3 [СЕК]#>",
                  "<ДЕЙСТВИЕ>=[ВЫБОР ИЗ]<отнять>:<прибавить>:<умножить на>[КАК]1:1:1",
                  "<ЧИСЛО1>=[ВЫБОР ИЗ]1:2:3:4:5:6:7:8:9[КАК]1:1:1:1:1:1:1:1:1",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",

                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================
              //========================== Умножения со скобками
              [
                [],
                [
                  "<УМНОЖЕНИЯ СО СКОБКАМИ>=<- УМНОЖЕНИЯ СО СКОБКАМИ - делать>;",
                  "<ЦИКЛ>=<ЧИСЛО1>;<ДЕЙСТВИЕ>;<ЧИСЛО1>;<#3 [СЕК]#>",
                  "<ДЕЙСТВИЕ>=[ВЫБОР ИЗ]<отнять>:<прибавить>:<умножить на>[КАК]1:1:1",
                  "<ЧИСЛО1>=[ВЫБОР ИЗ]1:2:3:4:5:6:7:8:9[КАК]1:1:1:1:1:1:1:1:1",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",

                  "[END EVAL PARAMETERS]",

                ],
               ],
              //================
               [
                [],
                [
                  "<ТЕСТ>=10<Z>",
                  "//Это комментарий 1",
                  "<Z>=<CC>;2<A>;2<B> //комментарий",
                  "<A>=3'присесть';<#<interval1> [СЕК]#>;4'наклониться'",   //по умолчанию msec, их можно не указывать
                  "<B>=2<BB>;<#19 [СЕК][%ДИСПЕРС]10#>;2'хлопнуть в ладоши'",//[%ДИСПЕРС]10 - дисперсия 10%, можно
        //"<B>=2<BB>;<#3 [СЕК][%ДИСПЕРС]10#>;2<хлопнуть в ладоши>",//[%ДИСПЕРС]10 - дисперсия 10%, можно этот блок не указывать
                  //"<BB>=<расслабиться>",
                  "<BB>=[ВЫБОР ИЗ]'a10':'a23':'a33':'a40':'a50':'a60':'a70':'a80':'a90'[КАК]1:1:1:1:1:1:1:1:1",
                  "//Это комментарий 2",
                  //"<CC>=[eval]2+2[eval]", //В знаках доллара формула вычисления (сразу либо в момент исполнения)
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "<CC>=2+2",
                  "<interval1>=2+3",
                  "<testonline>=2*_номер_итерации_",
                  "[END EVAL PARAMETERS]",

                ],
                [``],//! ТЕСТОВАЯ СТРОКА НОВОГО ФОРМАТА ПОД EVAL
               ],
    //========================== ДЫХАТЕЛЬНАЯ ЛЕСЕНКА
               [
                [],
                [
                  "<ДЫХАТЕЛЬНАЯ ЛЕСЕНКА>=<Nhalf><Z31>;<Nhalf><Z32>//ДЫХАТЕЛЬНАЯ ЛЕСЕНКА",
                  "//Это комментарий 1", //$CC$ - значит будет попытка вычислить СС по формуле (ищи $CC$=...)
                  "<Z31>=<<say31>>;<#<delta31> [СЕК]#> //[МСЕК] !!! внутри угловых параметр в угловых !!",
                  "<Z32>=<<say32>>;<#<delta32> [СЕК]#> //[МСЕК]",
                  "//",
                  "//Блок параметров тренировки. В нем запрещены умножения на число и выбор",
                  "//Вычисления начинаются с подстновок в данном блоке",
                  "[BEGIN EVAL PARAMETERS]",
                  "<Nhalf>=8*<par4T> / (<par2min> + <par3max>)",
                  "<par4T>=240",
                  "<par2min>=5",
                  "<par3max>=10+3//!!сделать линейную формулудо 20 за 3 года" ,
                  "<delta31>=(<par2min> + (_номер_итерации_/8-0) * (<par3max>-<par2min>)/((1*<par4T>/(<par3max> + <par2min>))-0) )/8",
                  "<delta32>=(<par3max> + ( 1*<par4T> / (<par2min> + <par3max>)     - _номер_итерации_/8+0) * (<par3max>-<par2min>)/((1*<par4T>/(<par3max> + <par2min>))-1) )/8",
                  '<say31>=(((Math.floor((_номер_итерации_-1)/4)%2))?"ы":"о")',
                  '<say32>=(((Math.floor((_номер_итерации_-1)/4)%2))?"ы":"о")',
                  "<testtt>=_номер_итерации_ ",
                  //"<say32>=ы", // iif(нечетное(целоеделна4(номеритерации1)),ы,о)
                  "[END EVAL PARAMETERS]",

                ],
               ],
    //===================================================================
    ];
  var GlTest = 1;
  var GltxtSpeek  = document.getElementById("idTextsToSpeek");
  var GlUtterance = new SpeechSynthesisUtterance("");
  var calendar = document.getElementById("actionsInCalendar");
  var currentT = document.getElementById("currentT");
  var inputMinDay = document.getElementById("inputMinDay");
  var inputMaxDay = document.getElementById("inputMaxDay");
  var getTextToPrint = document.getElementById("getTextToPrint");
  var selectAllTrain = document.getElementById("selectAllTrain");
  var btnSelectAllTrain = document.getElementById("btnSelectAllTrain");
  var txtTextTime  = document.getElementById("idTextTime");
  var docTextTrain = document.getElementById("idTextTrain");
  var docNoSound = document.getElementById("idNoSound");
  Gl_DaysBeforeNowForShow = inputMinDay.value;
  Gl_DaysAfterNowForShow = inputMaxDay.value;
  var inputFilterStr = document.getElementById('filterStr');
  var Gl_currentTrainName =""
  var Gl_sDelim = '/DELIMITER/'
  var Gl_txtPrint = document.createElement('textarea');
  var Gl_calendarVisible = true;//false;
  //длЯ задержки начала тренировки (чтобы закрепить смартфон после нажатия стартовой кнопки)
  var GlnDelay = 0;
  var glTxtSay="1";
  var Gl_trainTime
  var Gl_decodeExternalCallValue=""


  function btnImportTrainInGenOnClick(){
    download(GltxtSpeek.value, (new Date()).getFullYear()+'_'+(new Date()).getMonth()+'_'+(new Date()).getDate()+'_'+selectAllTrain.value+'_train.gen', 'text/plain')
  }

  function loadFromGen(input){
      let file = input.files[0];
      let reader = new FileReader();
      reader.readAsText(file);
      reader.onload = function() {
                            var str = reader.result
                            GltxtSpeek.value = str
                        };
      reader.onerror = function() {
          console.log(reader.error);
        };
  }
  function runFromRTM(input){
      let file = input.files[0];
      let reader = new FileReader();
      reader.readAsText(file);
      reader.onload = function() {
          try{
            var str = reader.result
            Gl_aRithmLisp = str.split('\n')
            alert("Будет запущена тренировка из файла ")
            execTrain1(0,"Run")
          } catch(e){
            alert('Не удалось запустить тренировку, проверьте формат файла. (чередование строк - время(в мс), текст, начинается с времени))')
          }
        };
      reader.onerror = function() {
          console.log(reader.error);
        };
  }

  function loadTrainAndCalFromFile(input){
      let file = input.files[0];
      let reader = new FileReader();
      reader.readAsText(file);
      reader.onload = function() {
          try{
            var str = reader.result
            eval(str)
            loadTrainData()
            alert('Загружен календарь и список тренировок')
          } catch(e){
            alert('Не удалось прочитать данные, проверьте формат файла. Должен быть js формат (без var!): "Gl-aMetaMetaCalendar=...;Gl_aMetaRithm=...;')
          }
        };
      reader.onerror = function() {
          console.log(reader.error);
        };
  }


  function downloadTrainAndCalFromFile(input){
    var sDownload= ""
    sDownload+= "//===== КАЛЕНДАРИ ================================\n"
    sDownload+= "Gl_aMetaMetaCalendar = \n"
    sDownload+='[\n'
    for(var i =0;i<Gl_aMetaMetaCalendar.length;i++){
      sDownload+='  [' +'[new Date('+Gl_aMetaMetaCalendar[i][0][0].getFullYear()+','
                                    +Gl_aMetaMetaCalendar[i][0][0].getMonth()+','
                                    +Gl_aMetaMetaCalendar[i][0][0].getDate()+','
                                    +Gl_aMetaMetaCalendar[i][0][0].getHours()+','
                                    +Gl_aMetaMetaCalendar[i][0][0].getMinutes()+','
                                    +Gl_aMetaMetaCalendar[i][0][0].getSeconds()
                                    +')],\n'
      for(var j =1;j<Gl_aMetaMetaCalendar[i].length;j++){
        sDownload+='    [\n'
        for(var k =0;k<Gl_aMetaMetaCalendar[i][j].length;k++){
          sDownload+='    `'+Gl_aMetaMetaCalendar[i][j][k]+'`,\n'
        }
        sDownload+='    ],\n'
      }
      sDownload+='  ],\n'
    }
    sDownload+=']\n\n\n'

    //
    sDownload+= "//===== ТРЕНИРОВКИ ==============================\n"
    sDownload+= "Gl_aMetaRithm = \n"
    sDownload+='[\n'
    for(var i =0;i<Gl_aMetaRithm.length;i++){
      sDownload+='[  [],\n'
      for(var j =1;j<Gl_aMetaRithm[i].length;j++){
        sDownload+='    [\n'
        for(var k =0;k<Gl_aMetaRithm[i][j].length;k++){
          sDownload+='    `'+Gl_aMetaRithm[i][j][k]+'`,\n'
        }
        sDownload+='    ],\n'
      }
      sDownload+='  ],\n'
    }
    sDownload+=']\n'
    download(sDownload, (new Date()).getFullYear()+'_'+(new Date()).getMonth()+'_'+(new Date()).getDate()+'_'+'GenTrainsAndCalendarFromTotalCalendarJS.genall', 'text/plain')
  }
  function changePageCalendar(isCheck){
    if (isCheck)
      document.getElementById("calendarPage").style.display ='block'
    else
      document.getElementById("calendarPage").style.display ='none'
  }
  function changePageTrain(isCheck){
    if (isCheck)
      document.getElementById("trainPage").style.display ='block'
    else
      document.getElementById("trainPage").style.display ='none'
  }
  function changeSelectMode(isChecked){
    if (isChecked) {
      selectAllTrain.setAttribute("multiple","multiple")
      alert('Вы можете выбрать несколько тренировок для одновременного выполнения, используя клавишу [CTRL].')
    } else selectAllTrain.removeAttribute("multiple")
    readFilteredListOfTrainings('',null)
  }

  function btnRecalcCalOnClick() {
    //alert(Gl_aMetaMetaCalendarSelected)
    //? Gl_calendarVisible = !Gl_calendarVisible
    //? if (Gl_calendarVisible){

      Gl_DaysBeforeNowForShow = inputMinDay.value;
      Gl_DaysAfterNowForShow = inputMaxDay.value;
      document.getElementById("idDivActionCalendar").style.height = "20px"
      fillForm()
      //? document.getElementById("btnRecalcCal").innerHTML = 'Скрыть календарь'
      //? document.getElementById("idDivActionCalendar").style.display ='inline'
    //? } else {
    //  //? document.getElementById("idDivActionCalendar").style.display ='none'
    //  document.getElementById("btnRecalcCal").innerHTML = 'Показать календарь'
    //}

  }

  // Function to download data to a file - взято из внешнего источника
  function download_old(data, filename, type) {
        var file = new Blob([data], {type: type});
        if (window.navigator.msSaveOrOpenBlob) // IE10+
            window.navigator.msSaveOrOpenBlob(file, filename);
        else { // Others
            var a = document.createElement("a"),
                    url = URL.createObjectURL(file);
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            setTimeout(function() {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 0);
        }
  }

  function download(text,filename, type) {
      var element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
      element.setAttribute('download', filename);

      element.style.display = 'none';
      document.body.appendChild(element);

      element.click();

      document.body.removeChild(element);
  }

  Date.prototype.yyyymmddhhmmss = function(sBetweenDateandTime='') {
      var mm = this.getMonth() + 1; // getMonth() is zero-based
      var dd = this.getDate();
      var hh = this.getHours();
      var mmin = this.getMinutes();
      var ss = this.getSeconds();

      return [this.getFullYear(),
              (mm>9 ? '' : '0') + mm,
              (dd>9 ? '' : '0') + dd,
              sBetweenDateandTime,
              (hh>9 ? '' : '0') + hh,
              (mmin>9 ? '' : '0') + mmin,
              (ss>9 ? '' : '0') + ss
             ].join('');
  };

    Date.prototype.yyyymmdd = function() {
      var mm = this.getMonth() + 1; // getMonth() is zero-based
      var dd = this.getDate();
      return [this.getFullYear(),
              (mm>9 ? '' : '0') + mm,
              (dd>9 ? '' : '0') + dd,
             ].join('');
  };



  //выгрузить события календаря (для загрузки в Outlook Google и пр. календари)
  function btnImportCalOnClick(){
    btnRecalcCalOnClick() // если изменили период и не пересчитали
    var arrayFromList = [];

    // тянем все теги li из блока с нужным  ID
    var items = document.getElementById("actionsInCalendar").getElementsByTagName("li");
    //UID:${''+nGUID+''+i}@default
    var sICS =
`BEGIN:VCALENDAR
PRODID:Calendar
VERSION:2.0\n`
    //var nGUID =  (new Date()).yyyymmddhhmmss()
    for (var i = 0; i < items.length; ++i) {
      var nGUID = items[i].innerHTML.replaceAll('\n','').replaceAll(' ','')//+i
      nGUID = nGUID.substr(nGUID.indexOf('>')) // отсечем зависящий от i куок вначале
      sICS +=
`BEGIN:VEVENT
UID:${''+nGUID+''}@default
CLASS:PUBLIC
DESCRIPTION:https://robinzgit.github.io/TotalCalendarJS/index.html?startwith=${forURL(Gl_aMultiCalendar[2*i+1].trim(),'String->URL')}&externalcall=1
DTSTAMP;VALUE=DATE-TIME:${(new Date()).yyyymmddhhmmss('T')}
DTSTART:${Gl_aMultiCalendar[2*i].yyyymmddhhmmss('T')}
DTEND:${Gl_aMultiCalendar[2*i].yyyymmddhhmmss('T')}
SUMMARY;LANGUAGE=en-ru:${Gl_aMultiCalendar[2*i+1].trim()}
TRANSP:TRANSPARENT
BEGIN:VALARM
ACTION:DISPLAY
DESCRIPTION:This is an event reminder
TRIGGER:-P0DT0H0M0S
END:VALARM
END:VEVENT\n`
    }
    sICS += 'END:VCALENDAR'
    download(sICS, 'FromTotalCalendarJS.ics', 'text/plain')
  }

  //импорт тренировки (кастомный формат .rtm)
  function btnImportTrainOnClick(){
      var aRithmLisp=[]
      var aSimult = []
      if (GltxtSpeek.value.indexOf('[ОДНОВРЕМЕННО С]')>=0){
        var arrStr = GltxtSpeek.value.split('[ОДНОВРЕМЕННО С]')
        for (i=0;i<arrStr.length;i++) {
          aSimult.push([[],arrStr[i].split(Gl_sDelim)])
        }
        aRithmLisp = stus(aSimult,'diff')
      }else aRithmLisp=getArithm(GltxtSpeek.value.split(Gl_sDelim));

      aRithmLisp[0]=4000
      aRithmLisp.forEach(v=>v=String(v).replaceAll('\n',''))

      //Gl_aRithmLisp=aRithmLisp.slice() //!!!!!!!!!!!

      var sText='1000\n '
                +Gl_currentTrainName.replaceAll('\n','').replace(/[&\/\\#,+()$~%.'":*?<>{}]/g, '')
                +'. Тренировка продлится ' +calcTtrainTime(aRithmLisp)
                +' минут\n '
                +aRithmLisp.join('\n')
      download(sText, Gl_currentTrainName.replace(/[&\/\\#,+()$~%.'":*?<>{}]/g, '')+'.rtm', 'text/plain')
  }


  //пытаемся вычислить строку как формулу. если не получается оставляем строку как есть
  function ev(s){
  	  if (!((s.trim())==""))
  	    try{return eval(s)} catch (exception){return s}
  	  else return ""
  }

  //замена пробелов и пр в имени трени для генерации URL +обратная замена для поиска трени из URL
  function forURL(sTrainName,sMode){
    var sSpace='___space___'
    if (sMode == 'String->URL')
      return sTrainName.replaceAll(' ',sSpace)
    if (sMode == 'URL->String')
      return sTrainName.replaceAll(sSpace,' ')
  }

  //Выводим данные на форму при загрузке страницы
  function loadTrainData() {
    //
    document.getElementById('externalcall').style.display='none';
    setTimeout(function () {
        document.getElementById('externalcall').style.display='block';
    }, 1500);
    setTimeout(function () {
        document.getElementById('externalcall').style.display='none';
    }, 5500);
    //
    if (Gl_aMetaMetaCalendarSelected.length==0){
      //alert('сброс выбора календарей')
      for (var i=0;i<Gl_aMetaMetaCalendar.length;i++) Gl_aMetaMetaCalendarSelected.push(true) //первоначально все календари выбраны, учитываются в общем календаре
    }
    //beep0(1000, 0.5)
    //параметр - с какую треню выбрать по умолчанию
    var startWithValue = location.href
    try{
      startWithValue =forURL( location.href.split('?')[1].split('&').filter((v)=>{return (v.indexOf('startwith')>=0)}).join(' ').split('=')[1],'URL->String');
    } catch(e){ startWithValue= ''};

    //параметр - для вызова с сервера
    var externalCallValue = location.href
    // alert(externalCallValue)
    try{
      externalCallValue = location.href.split('?')[1].split('&').filter((v)=>{return (v.indexOf('externalcall')>=0)}).join(' ').split('=')[1];
    } catch(e){ externalCallValue= ''};

    if (externalCallValue!=undefined)
      Gl_decodeExternalCallValue = decodeURIComponent(externalCallValue)
    else
      Gl_decodeExternalCallValue=''
    fillForm(decodeURIComponent(startWithValue))

    //GltxtSpeek.value += "\n\n Для изменения тренировки необходимо редактировать запускаемый файл html.\n";
    if (Gl_decodeExternalCallValue.valueOf().length==0){
     //! alert("Чтобы не было перерыва в тренировке из-за выключения экрана не забудьте запустить программу типа Stay Alive (android)")
    }else{
      //!      document.getElementById('externalcall').style.display='block'
      document.getElementById("idDivCalendar").style.display ='none'
      document.getElementById("idDivCalendarBtns").style.display ='none'
      document.getElementById("idDivActionCalendar").style.display ='none'
    }
  }

  //изменение размеров элементов при изменении размеров окна
  function resizeAll(){
    //GltxtSpeek.style.width = button.style.width;
  }


  function say(str){
        //alert(Gl_aRithmLisp);
        if (!docNoSound.checked){
            var utterance0 = new SpeechSynthesisUtterance(str);
            utterance0.rate=document.getElementById("inputRate").value;// 1.5; //скорость речи
            //!! window.speechSynthesis.cancel()
            window.speechSynthesis.speak(utterance0);
            //
        } else{
            docTextTrain.value = str
            if (docTextTrain.style.backgroundColor=='yellow')
              docTextTrain.style.backgroundColor='white'
            else
              docTextTrain.style.backgroundColor='yellow'
            docTextTrain.scrollTop = docTextTrain.scrollHeight
            window.scrollBy(0,-100)
        }

        var d=new Date();
        aCurr = [d,str];
        //!! вычисляется во второй проход но тут не помешает, тк этой переменной в формуле уже нет
        //_history_.push(aCurr);
      }

  function hasOnlineCalcedParams(str){
     return ((str.indexOf('_номер_итерации_')>=0)
             ||(str.indexOf('_прошло_лет_')>=0)
             ||(str.indexOf('_прошло_месяцев_')>=0)
             ||(str.indexOf('_прошло_недель_')>=0)
             ||(str.indexOf('_прошло_дней_')>=0)
             ||(str.indexOf('_прошло_часов_')>=0)
             ||(str.indexOf('_прошло_минут_')>=0)
             ||(str.indexOf('_прошло_секунд_')>=0)
             ||(str.indexOf('_прошло_милисекунд_')>=0)
             ||(str.indexOf('_history_')>=0)
            )
   }


   function calcInterval(sInterval){ //распарсить интервал вида <#19 [СЕК][%ДИСПЕРС]10#> или <#19 [СЕК]#>
        //дисперсия

    var sRet = sInterval;
    var nDisp=0;
        try{
          if (sRet.indexOf('[%ДИСПЕРС]')>=0)
             nDisp = Number(sRet.split('[%ДИСПЕРС]')[1]);
        }catch(e){}

        sRet = calcMilliseconds(sRet)

        if (nDisp>0){
            nDipOne = 2*(0.5-Math.random())*nDisp;
            sRet = Math.round((Number(sRet)*(100+nDipOne)/100)*100)/100;
        };

        return sRet;
   }


   function calcEval(nMode,str){ //вычисляем вставки [eval]
                              // nMode ="N"- число  ="S"-строка
                    var sRet=str

                    if ((str.indexOf('[eval]')>=0)){//нужно досчитать интервал по онлайн-параметрам
                       //разбиваем строку в массив через $, для четных индексов массива заменяем элемнт на eval(element) и собираем зново в строку уже с пустым разделителем
//alert(str)
                       var aDelta = str.split('[eval]');
                       for(i=1; i< aDelta.length; i+=2){
                         try{
                           aDelta[i]=eval(aDelta[i]);
                         } catch(e) {aDelta[i]="0" //if(!(nMode=="S")) aDelta[i]="0" else aDelta[i]=""
                                    }
                       }

                       sRet = aDelta.join("");
                       if(!(nMode=="S")){
                         sRet=calcInterval(sRet); //!!!!
                         GlnDelta = Math.round(Number(sRet));
                       }

                     }else {
                         if(!(nMode=="S")){
                             //alert(sRet)
                           sRet=calcInterval(sRet); //!!!!
                           GlnDelta = Math.round(Number(sRet));

                         }
                     }

                     return sRet;
   }

   function calcTtrainTime(aRithmLisp){
   //расчет времени трени
            try{
              var nTime = 0
              for(var i =-1; i<aRithmLisp.length-1;i=i+2)
                nTime+=calcInterval(String(aRithmLisp[i+1]))
              nTime = Math.round(10*nTime/(1000*60))/10;
            } catch(e) {nTime = -100}
            return nTime
    }

   function fSayInTime(){
        //alert(Gl_aRithmLisp)
        if(Gl_IsFinished) return

        var dCurr = new Date();
        if(!GlflSayIntro2)
           if((dCurr-GldPrev)>=0/*!10000*/){
               GlflSayIntro2=true;
               GldPrev = new Date();
           }
        if (!GlflSayIntro){
            GlflSayIntro=true;
            //расчет времени трени
            Gl_trainTime = calcTtrainTime(Gl_aRithmLisp);
            say('Тренировка продлится ' +Gl_trainTime+' минут');
            GlBegTime = new Date();

        } else
          if (GlflSayIntro2) {
            if (GlnInd <(Gl_aRithmLisp.length)){
              dCurr = new Date();
              var dT = (dCurr-GlBegTime)
              txtTextTime.value = "Прошло:   "+Math.floor(dT/(60*1000)) + "  минут  " + (Math.floor(dT/(1000)))%60 + "  секунд из  "+Gl_trainTime+" мин."
              if((dCurr-GldPrev)>=GlnDelta){ //прошел требуемый интервал
                     //----онлайн параметры--------------------------------------
                     //!! вычисляется во второй проход но тут не помешает, тк этой переменной в формуле уже нет
                     _номер_итерации_+=1;
                     //-----------------------------------------------------------
                     try{
                       document.getElementById('buttonCurrentTr' + GlnInd).style.background='green'
                     } catch(e){}
                     //NEW !! ДОБАВИТЬ СЮДА АНАЛИЗ ДЕЛА С ВЫБОРОМ ДЕЛ С ПОДТВЕРЖДЕНИЕМ ПОЛЬЗОВАТЕЛЯ
                     //на форму добавить невидимый блок, в котором будут отрисовываться кнопки дел к выбору
                     //...
                     /*
                     можно в calcEval можно тут - если в Gl_aRithmLisp[GlnInd] есть код списка выбора (придумать формат, напр [выбор с подтверждением из]... имена дел..[отобразить название на форме как]..
                     ХХ - начитка кнопок дел
                     сделать видимым блок с этими кнопками
                     по нажатии кнопки выполнить (прописать в onClick  XX)
                              -оформить отдельной ф-ей - вызвать что-то типа getARitmm (выбранного дела), но без глобалей и с передаваемым парамеиром имя дела
                     получившийся массив вставить вместо Gl_aRithmLisp[GlnInd]
                     ---
                     Начать надо с этого: написать что-то типа getARitmm (выбранного дела), но без глобалей и с передаваемым парамеиром имя дела.
                                         И использовать ее в getARitmm

                     */
                     //...
                     //
                     //сказать текст текущего дела
                     Gl_aRithmLisp[GlnInd]= calcEval("S",Gl_aRithmLisp[GlnInd])
                     say(Gl_aRithmLisp[GlnInd]);
                     if(Gl_aRithmLisp[GlnInd]==TXT_BTN_FINISHED) Gl_IsFinished=true
                     //сбросить начало отсчета отсчет времени, пересчитать текущий интервал и индекс дела
                     GldPrev = new Date();
                     Gl_aRithmLisp[GlnInd+1]= calcEval("N",String(Gl_aRithmLisp[GlnInd+1])) //!!!String
                     GlnInd+=2;
              }
            } else {
                GlnInd+=2;
                say("Тренировка завершена")
            }
        }

  }

  function calcMilliseconds(str){ //расчитывает длительность промежутка типа "1 [СУТ]" в милисекундах
        if (str.indexOf('[МСЕК]')>=0) return Number(str.split('[МСЕК]')[0]) //deltaMs = Number(deltaMs.split('[МСЕК]')[0])
        else if ((str.indexOf('[СЕК]')>=0)) return Number(str.split('[СЕК]')[0])*1000
        else if ((str.indexOf('[МИН]')>=0)) return Number(str.split('[МИН]')[0])*1000*60
        else if ((str.indexOf('[ЧАС]')>=0)) return Number(str.split('[ЧАС]')[0])*1000*60*60
        else if ((str.indexOf('[СУТ]')>=0)) return Number(str.split('[СУТ]')[0])*1000*60*60*24
        else if ((str.indexOf('[НЕД]')>=0)) return Number(str.split('[НЕД]')[0])*1000*60*60*24*7
        else return Number(str)
  }

  function onSelectTrain(nInd){
     execTrain1(nInd,"Act")
  }

  function onSelectCalendar(nInd){
     if (nInd<0) {
         document.getElementById("selectedCalendars").options.length = 0
         for(var i=0; i<Gl_aMetaMetaCalendar.length;i++){
           var oOption =  new Option(Gl_aMetaMetaCalendar[i][1][0].split('=')[0],i)
//???@ OK if calendars are not filtered now if select is filtered !?
           oOption.selected = Gl_aMetaMetaCalendarSelected[i]
           document.getElementById("selectedCalendars").options.add( oOption )
         }
     } else{
        for(var i=0; i<document.getElementById("selectedCalendars").options.length;i++)
//???@  OK if calendars are not filtered now ???? not i !!!??  Gl_aMetaMetaCalendarSelected[i]
          Gl_aMetaMetaCalendarSelected[i]=document.getElementById("selectedCalendars").options[i].selected
        btnRecalcCalOnClick()
     }

  }

  function addAction (sMode, oListbox, text, value, isDefaultSelected, isSelected,sStyle,fl,btnPrevId,nRepeat)
  {
    //document.getElementById("checkTrainPage").checked = true
    var retId=""

    if (sMode=='currentTShort'){
      btn = document.getElementById(btnPrevId)
      btn.innerHTML= text +" (повторить "+nRepeat
          +" раз)"

      retId = btnPrevId
      return retId
    }else{
      var li = document.createElement("li");
      var btn = document.createElement('button');
      var txt = document.createTextNode(text);

      btn.appendChild(txt);
      btn.setAttribute('type', 'button');

      if(sStyle.length>0){
        if(fl) btn.setAttribute('style',sStyle+';background:yellow')
        else  btn.setAttribute('style',sStyle+';background:lightgreen')
      }
      if (sMode=='currentT') btn.setAttribute('style',sStyle)

      if (sMode=='all'){
        var oOption =  new Option(text,value);
        btnSelectAllTrain.setAttribute('onclick','execTrain1(selectAllTrain.value,"Act")'); //!! RUN
        selectAllTrain.options.add( oOption ) ;//!!!
      }else if (sMode=='calendar'){
        btn.setAttribute('onclick','execTrain1('+value+',"Calendar")');
        retId = 'buttonCalendar' + value
        btn.setAttribute('id', retId);
        try{ //добавляем высоту элемента при добавлении кнопки календаря (доходим до высоты 400 и останавливаемся)
          if (Number( document.getElementById("idDivActionCalendar").style.height.replace("px",""))<400)
            document.getElementById("idDivActionCalendar").style.height =Number(document.getElementById("idDivActionCalendar").style.height.replace("px","")) +Number(btn.style.height.replace("px","")) + "px"
        }catch(e) {}
      }else if (sMode=='currentT'){
        btn.setAttribute('onclick','navigate('+value+')');
        btn.style.background='yellow';
        retId = 'buttonCurrentTr' + value
        btn.setAttribute('id', retId);
      }

      if (sMode!='all'){
        li.appendChild(btn);
        if (isDefaultSelected) li.defaultSelected = true;
        else if (isSelected) li.selected = true;
        oListbox.appendChild(li);
      }
      return retId
    }
  }

  function readFilteredListOfTrainings(sFilt,loadTrain){
    selectAllTrain.options.length = 0
    for(var i=0; i<Gl_aMetaRithm.length; i++) {
      var flAdd = true
      if (flAdd)
        flAdd = ((sFilt.length==0)
          ||((sFilt.length>0)&&(Gl_aMetaRithm[i].join(' ').toUpperCase().indexOf(sFilt.toUpperCase())>=0))
          )
      if (flAdd && (selectAllTrain.getAttribute("multiple")=="multiple"))
        flAdd = !(Gl_aMetaRithm[i].join(' ').toUpperCase().indexOf('[ОДНОВРЕМЕННО С]')>=0)

      if (flAdd)
        addAction("all",null/*actions*/,Gl_aMetaRithm[i][1][0].split('=')[0],i,false,false,"width:100%",false)

    }
    if (loadTrain!==null)
      for(var i=0; i<selectAllTrain.options.length;i++)
        if (selectAllTrain.options[i].text.trim()=="<"+loadTrain.trim()+">")
          selectAllTrain.selectedIndex = i
      //selectAllTrain.selectedIndex = getTrainIndexByName("<"+loadTrain+">")
  }

  //"стусовка" тренировок из массива (может не работать, если промежутки времени зависят от онлайн-вычисляемых параметров)
  //  nMode == 'paint' - вывод календаря (и входной массив 3-мерный)
  //           'diff' - "дифференцирование", расчет промежутков времени (и входной массив 2-мерный)
  function stus(aTrains, nMode){
    //собираем все календари в один:

    //1. Собираем одномерный массив, одновременно заменяя промежутки времени на даты ("интегрирование")
    var ret_aMultiCalendar=[].slice()
    var now0 = new Date()

    var  dCurr =  now0
    var  nCurr = 0
    var aCalendar = []
    var sDeltaMs=''
    var deltaMs = 0
    for (var i=0; i<aTrains.length; i++)
    if((nMode == 'diff')||((nMode == 'paint')&&Gl_aMetaMetaCalendarSelected[i]))
    {
    //if((nMode == 'diff')||((nMode == 'paint')&&Gl_aMetaMetaCalendarSelected[i])) alert(Gl_aMetaMetaCalendarSelected[i])
        if (nMode == 'paint') {
          dCurr =  aTrains[i][0][0]
          aCalendar = getArithm(aTrains[i][1])
        } else {
          dCurr =  now0
          nCurr = 0
          aCalendar = getArithm(aTrains[i][1])
        }
        for (var j=1; j<aCalendar.length-1; j=j+2){
            if (hasOnlineCalcedParams(aCalendar[j-1])){
               alert('Слияние тренировок невозможно, поскольку имеются интервалы, рассчитываемые во время выполнения ('+aCalendar[j-1]+')');
               return null;
            }
            sDeltaMs=aCalendar[j-1]
            deltaMs = calcMilliseconds(sDeltaMs)
            dCurr= new Date(dCurr.setMilliseconds(dCurr.getMilliseconds()+deltaMs));
            nCurr+=deltaMs
            var nFromNow0 = ((dCurr.getTime()- now0.getTime())/(1000*60*60*24))
            if ((nMode != 'paint')||((nFromNow0>(-Gl_DaysBeforeNowForShow-1))&&(nFromNow0<Gl_DaysAfterNowForShow))){
              if(nMode=='diff') ret_aMultiCalendar.push(nCurr); else ret_aMultiCalendar.push(new Date(dCurr));
              ret_aMultiCalendar.push(aCalendar[j])

            }
        }
    }
//if (nMode=='diff'){alert (ret_aMultiCalendar)}
    //2. Сортируем пары
    for (var i=0; i<ret_aMultiCalendar.length-1; i=i+2)
        for (var j=i; j<ret_aMultiCalendar.length-1; j=j+2)
        //if (nMode=='paint'){alert (ret_aMultiCalendar[i]>ret_aMultiCalendar[j]);alert (ret_aMultiCalendar[i]);alert (ret_aMultiCalendar[j])}
            if (ret_aMultiCalendar[i]>ret_aMultiCalendar[j]){
              var d = new Date(ret_aMultiCalendar[j])
              var nd = ret_aMultiCalendar[j]
              var s = String(ret_aMultiCalendar[j+1])
              ret_aMultiCalendar[j] = ret_aMultiCalendar[i]     //??  if(nMode=='diff') ret_aMultiCalendar[j] = ret_aMultiCalendar[i]; else ret_aMultiCalendar[j] = new Date(ret_aMultiCalendar[i]);
              ret_aMultiCalendar[j+1] = String(ret_aMultiCalendar[i+1])
              ret_aMultiCalendar[i]=nd    //??  if(nMode=='diff') ret_aMultiCalendar[i]=nd; else ret_aMultiCalendar[j] = new Date(d);
              ret_aMultiCalendar[i+1] = String(s)
            }
    if (nMode == 'paint') {
        //3. Выводим отсортированные дела
        var sStyle =""
        var now = new Date()
        var dCurr = new Date(ret_aMultiCalendar[0])
        var fl= true
        for(var i=1; i<ret_aMultiCalendar.length-1; i+=2) {
           dCurrPrev = new Date(dCurr)
           dCurr = new Date(ret_aMultiCalendar[i-1]);
           if (!((dCurr.getFullYear()==dCurrPrev.getFullYear())&&(dCurr.getMonth()==dCurrPrev.getMonth())&&(dCurr.getDate()==dCurrPrev.getDate())))  fl=!fl
            if ((dCurr.getFullYear()==now.getFullYear())&&(dCurr.getMonth()==now.getMonth())&&(dCurr.getDate()==now.getDate()))
              sStyle ="width:100%;height:40px;color:red;"
            else sStyle ="width:100%;height:40px";
             addAction("calendar",calendar,dCurr.toLocaleString()  //!! преобразовать от даты + ...
                                +'   :    '+ret_aMultiCalendar[i] ,i,false,false,sStyle,fl);
        }
    } else {
        //3. "дифференцирование"
        var now = new Date()
        var dCurr = new Date(ret_aMultiCalendar[0])
        var dCurrPrev = new Date(dCurr)
        ret_aMultiCalendar[0]=1000
        for(var i=1; i<ret_aMultiCalendar.length-1; i+=2) {
          dCurrPrev = new Date(dCurr)
          if (i<ret_aMultiCalendar.length-1){
            dCurr = new Date(ret_aMultiCalendar[i+1]);  //!! было i-1
            var deltaT = dCurr.getTime() - dCurrPrev.getTime()
            ret_aMultiCalendar[i+1]=deltaT
          }
        }
    }
    return ret_aMultiCalendar.slice()
  }

  function fillForm(loadTrain=null)
  {
    //GlTest+=1;
    calendar.innerHTML = ''
    currentT.innerHTML = ''

    //========НАЧИТКА СПИСКА ВСЕХ КАЛЕНДАРЕЙ===========
    onSelectCalendar(-1)

    //=========НАЧИТКА СПИСКА ВСЕХ ТРЕНИРОВОК===========
    readFilteredListOfTrainings('',loadTrain);

    onSelectTrain(selectAllTrain.value);

    //собираем все календари в один:
    Gl_aMultiCalendar = stus(Gl_aMetaMetaCalendar, 'paint')
  }

  //поиск тренировки в глобальном массиве по наименованию (в угловых скобках)
  function getTrainIndexByName(sName){
    for(var i=0; i<Gl_aMetaRithm.length; i++)
      for(var j=0; j<Gl_aMetaRithm[i][1].length; j++)
          if(Gl_aMetaRithm[i][1][j].split('=')[0].trim()==sName.trim()) return i;
  }

  //поиск тренировки в отфильтрованном списке по наименованию (в угловых скобках)
  function getTrainIndexInSelectByName(sName){
    for(var i=0; i<Gl_aMetaRithm.length; i++)
      for(var j=0; j<Gl_aMetaRithm[i][1].length; j++)
          if(Gl_aMetaRithm[i][1][j].split('=')[0].trim()==sName.trim()) return i;
  }

  //Случайное от 0 до 1
  function fgetRandom(){
    //var d = new Date()
    //return d.getMilliseconds()/1000 //!плохо если вычисляется подряд неск-ко раз, одни и те же мсек..
    Math.random();
    return Math.random()
  }

  function test(){
    aA=[];
    for(i=12;i<14;i++) aA.push(Gl_aMetaRithm[i])
    //alert(aA)
    stus(aA, 'diff')
  }

  //<<для раскрытия скобок - первая и последняя открывающая скобка строки
  function isInAngleBrackets(str,pos){ //в угловых ли скобках символ на позиции pos строки str
     //если после pos идет > (нет < между  > И pos) - в угловых
     var indClose = str.indexOf('>',pos)
     var indOpen = str.indexOf('<',pos)
     return (indClose < indOpen) || ((indClose > 0)&&(indOpen < 0))
  }


  function fgetPosBracketOpen(str,pos){
    //проверить на рав-во ( и )
    //...TODO
    var nRet = str.indexOf('(',pos+1);
    if (nRet>=0)
      while (isInAngleBrackets(str,nRet))
        nRet = str.indexOf('(',nRet+1)
    return nRet;
  }

  function fgetPosBracketClose(str,pos){
    var nRet = pos
    var nSummaBrack = 1; //открытая скобка +1 закрытая -1, на pos - открытая скобка => =1
    while ((nSummaBrack>0)&&(nRet<str.length)){
          nRet++
          if (nRet>=str.length) return -1
          while (isInAngleBrackets(str,nRet)){
            nRet++
            if (nRet>=str.length) return -1
          }
          if (str[nRet]=='(') nSummaBrack++
          if (str[nRet]==')') nSummaBrack--
          if (nSummaBrack==0) return nRet
    }
  }
  //>>

  //выдает массив тренировки (начинается всегда с интервала, чередуется интервал-команда)
  function getArithm(aGen){

    var Gl_aGenRithm00 = aGen

  	//======  ГЕНЕРАЦИЯ РИТМА Gl_aRithm ИЗ ГЕНЕРАТОРА Gl_aGenRithm  ======

    //Удаление комментариев
    var Gl_aGenRithm0 = [];
    for(var i=0; i<Gl_aGenRithm00.length; i++){
      if (!(Gl_aGenRithm00[i].trim().indexOf('//')==0)) Gl_aGenRithm0.push(Gl_aGenRithm00[i].split("//")[0]);
    }

    var Gl_aGenRithm = Gl_aGenRithm0; //!! лишнее, осталось от старого

    //alert('после удаления комментариев \n'+Gl_aGenRithm)
    for(var i=0; i<Gl_aGenRithm.length; i++){ //?ОНО НАДО ВООБЩЕ ?? сначала возьмем слова в кавычках в угловые скобки
       while(Gl_aGenRithm[i].indexOf("'")>=0){
           Gl_aGenRithm[i]=Gl_aGenRithm[i].replace("'","<");
           Gl_aGenRithm[i]=Gl_aGenRithm[i].replace("'",">");
       }
       if (Gl_aGenRithm[i].trim()[Gl_aGenRithm[i].trim().length-1]==";"){ //уберем последнюю ;
           Gl_aGenRithm[i] = Gl_aGenRithm[i].trim().substr(0,Gl_aGenRithm[i].trim().length-1)
       }
    }
    //alert('после добавления угловых скобок словам в кавычках \n'+Gl_aGenRithm)

    //Раскрытие скобок типа <A> = 3(<AA>;5(<A2>;<A3>))
    var iCurr=0;
    var flContinue = (iCurr< Gl_aGenRithm.length)
    while (flContinue){
      if(Gl_aGenRithm[iCurr].indexOf('[BEGIN EVAL PARAMETERS]')>0) break //в блоке вычисления формул свои скобки, туда не лезть!
      var posOp = 0;
      var posCl =0;
      while (posOp>=0){

        //!! слабое звено, //улучшить через регулярки - произвольное кол-во пробелов

        Gl_aGenRithm[iCurr]=Gl_aGenRithm[iCurr].replaceAll(';)',')').replaceAll(' ;)',')').replaceAll('  ;)',')')//улучшить через регулярки - произвольное кол-во пробелов
        posOp = fgetPosBracketOpen(Gl_aGenRithm[iCurr],posOp);
        posCl = fgetPosBracketClose(Gl_aGenRithm[iCurr],posOp);
        if ((posOp>=0)&&(posCl>posOp)){
          var strNewName = Gl_aGenRithm[iCurr].substring(posOp+1,posCl).replaceAll('<','ABO').replaceAll('>','ABCl').replaceAll('(','RBO').replaceAll(')','RBCl').replaceAll('[','SBO').replaceAll(']','SBCl').replaceAll('#','RESH').replaceAll(';','SEMICOL')
          var strNewVal = Gl_aGenRithm[iCurr].substring(posOp+1,posCl)
          Gl_aGenRithm[iCurr]=Gl_aGenRithm[iCurr].replaceAll('('+strNewVal+')','<'+strNewName+'>');
          Gl_aGenRithm.splice(iCurr+1,0,'<'+strNewName+'>='+strNewVal)
        }
      }
     iCurr++;
     flContinue = (iCurr< Gl_aGenRithm.length)
    }
    //alert('после раскрытия скобок типа <A> = 3(<AA>;5(<A2>;<A3>)) \n'+Gl_aGenRithm)


    //Вычисление параметров
    var nBeg = -1;
    var nEnd = -1;
    for(var i=0; i<Gl_aGenRithm.length; i++){//ищем перую и последнюю строку блока
      if (Gl_aGenRithm[i].indexOf("[BEGIN EVAL PARAMETERS]")>=0) nBeg = i+1;
      if (Gl_aGenRithm[i].indexOf("[END EVAL PARAMETERS]")>=0) nEnd = i-1;
    }

    for(var i0=nBeg; i0<=nEnd; i0++)  //Подстановки (повторение цикла N раз)
        for(var i=nEnd; i>=nBeg; i--){
            var sOld = Gl_aGenRithm[i].split("=")[0].trim();//разобрали в массив правую часть после =
            var sNew = Gl_aGenRithm[i].split("=")[1];//разобрали в массив правую часть после =
            for(var j = nEnd; j>=nBeg; j--)
                   Gl_aGenRithm[j]=Gl_aGenRithm[j].split("=")[0]+"="+Gl_aGenRithm[j].split("=")[1].split(sOld).join(sNew); //replace заменит только первое вхождение..
        }
    if (nBeg>0){
        for(var i=nBeg; i<=nEnd; i++){ //вычисление формул (! в java нужно длать иначе)
            if (hasOnlineCalcedParams(Gl_aGenRithm[i]))
                Gl_aGenRithm[i] = Gl_aGenRithm[i].split('=')[0]+'=[eval]'+Gl_aGenRithm[i].split('=')[1]+'[eval]'
            else{
                try{
                  Gl_aGenRithm[i]=Gl_aGenRithm[i].split("=")[0]+"=<"+eval(Gl_aGenRithm[i].split("=")[1])+">"
                }catch(e){
                  Gl_aGenRithm[i]=Gl_aGenRithm[i].split("=")[0]+"=<"+Gl_aGenRithm[i].split("=")[1]+">"
                }
            }
        }
        Gl_aGenRithm[nBeg-1]="<"+Gl_aGenRithm[nBeg-1]+">=<__"+Gl_aGenRithm[nBeg-1]+"__>" //строка заголовка блока - приводим к стандартному виду (хотя использоваться не будет)
        Gl_aGenRithm[nEnd+1]="<"+Gl_aGenRithm[nEnd+1]+">=<__"+Gl_aGenRithm[nEnd+1]+"__>" //строка окончания заголовка блока - приводим к стандартному виду (хотя использоваться не будет)
    }

    //alert('после вычисления параметров \n'+Gl_aGenRithm)

    //Подстановка из блока параметов в основной блок
    for(var i=nBeg; i<=nEnd; i++){
        var sOld = Gl_aGenRithm[i].split("=")[0].trim();//разобрали в массив правую часть после =
        var sNew = Gl_aGenRithm[i].split("=")[1];//разобрали в массив правую часть после =
        for(var j=0; j<nBeg; j++)
            Gl_aGenRithm[j]=Gl_aGenRithm[j].split("=")[0]+"="+Gl_aGenRithm[j].split("=")[1].split(sOld).join(sNew);
    }

    for(var i=0; i<nBeg; i++){//вычищаем угловые скобки внутри блоков интервала (внутри #..#)
       var aRr = Gl_aGenRithm[i].split("#")
       for (var j = 1; j < aRr.length; j+=2){
           aRr[j] = aRr[j].split("<").join("").split(">").join("")
           Gl_aGenRithm[i]=aRr.join("#")
       }
    }
    //alert('перед удалением угловых скобок из умножений \n'+Gl_aGenRithm)

    for(var i=0; i<nBeg; i++){//вычищаем угловые скобки вокруг умножений (признак - наличие >< без разделителя)
       var sClear = ""
       var flIsTmsDetected= false

       for(var j=Gl_aGenRithm[i].length-0; j>=1 ; j--){
          if((""+Gl_aGenRithm[i][j-1]+Gl_aGenRithm[i][j]).valueOf()==("><").valueOf()){
             flIsTmsDetected = true
          }
          else if (flIsTmsDetected &&(Gl_aGenRithm[i][j-1]===("<") )) flIsTmsDetected= false
               else sClear=""+Gl_aGenRithm[i][j-1]+""+sClear
       }
       Gl_aGenRithm[i]=sClear
    }
   // alert('после подстановки из блока параметов в основной блок \n'+Gl_aGenRithm)


    //Замена умножений N<A>
    for(var i=0; i<Gl_aGenRithm.length/*-nBeg ??*/; i++){
        if (!(Gl_aGenRithm[i].indexOf("[ВЫБОР ИЗ]")>=0)){
            var sI="";
            var sHead = Gl_aGenRithm[i].split("=")[0];
            var aI = Gl_aGenRithm[i].split("=")[1].split(";");//разобрали в массив правую часть после =
            for(var j=0; j<aI.length; j++){
              var sNum = aI[j].trim().split('<')[0]; //!!ПРЕДВАРИТЕЛЬНАЯ ПРОВЕРКА НА ССОТВ < >
              var sVal = '<'+aI[j].trim().split('<')[1];
              var nNum = 1;
              if (sNum.trim().length>0)
                var nNum =  Number(sNum)
              sI = sI + sVal.repeat(nNum)
              /* ! Попытка использовать вставку ИНДЕКС при повторениях - проблема - в случае вложенных скобок не работает как хотелось бы - в этом случае вообще говоря имеется несколько вложенных индексов, наверное их нужно суммировать в один
              for(var k=0;k<nNum;k++) {
                if (sVal.indexOf('[ИНДЕКС]')>=0) alert (sVal+'   k='+k)
                sI+=sVal
                sI=sI.replaceAll('[ИНДЕКС]',k+1).replaceAll('[ПОСЛЕДНИЙ ИНДЕКС]',nNum)
              }
              */
            }
            Gl_aGenRithm[i] = sHead+'='+sI;
        }
    }
   //alert('после замены умножений \n'+Gl_aGenRithm)

    //Подстановки
    /*
    Общий принцип подстановок.
    1: Ищем строку, ни один из элементов списка которой не является правой частью другой строки (в т.ч. данной строки).
    Такая строка найдется, иначе если все строки содержат в списках ссылки, то имеется цикл (доказать от противного).
      Заменяем на левую часть данной строки все вхождения ее правой части в других строках, исключаем данную строку из дальнейшено поиска и замен (повторяем 1:)
    НО
    можно просто повторить цикл подстановки строки N раз (доказать..)
    */

    for(var i0=0; i0<Gl_aGenRithm.length; i0++)  //повторение цикла N раз
        for(var i=Gl_aGenRithm.length-1; i>=0; i--){
            var sOld = Gl_aGenRithm[i].split("=")[0].trim();//разобрали в массив правую часть после =
            var sNew = Gl_aGenRithm[i].split("=")[1];//разобрали в массив правую часть после =
            var aProb = sNew.split("[ВЫБОР ИЗ]");//выбор вероятностных дел.
            for(var j = Gl_aGenRithm.length-1/*!!i-1*/; j>=0; j--){
               if (aProb.length>1){
    //...
               }else
                   Gl_aGenRithm[j]=Gl_aGenRithm[j].split("=")[0]+"="+Gl_aGenRithm[j].split("=")[1].split(sOld).join(sNew); //replace заменит только первое вхождение..
            }
        }

   // alert('после подстановок \n'+Gl_aGenRithm[0])


    //В самом конце подстановка дел с выбором
    for(var i0=0; i0<Gl_aGenRithm.length; i0++)  //повторение цикла N раз
        for(var i=Gl_aGenRithm.length-1; i>=0; i--){
            var sOld = Gl_aGenRithm[i].split("=")[0].trim();//разобрали в массив левую часть после =
            var sNew = Gl_aGenRithm[i].split("=")[1];//разобрали в массив правую часть после =
            var aProb = sNew.split("[ВЫБОР ИЗ]");//выбор вероятностных дел.
            for(var j = i-1; j>=0; j--){
               if (aProb.length>1){
                  //выбираем случ число от 0 до суммы пропорций, в какой отрезок оно попадет - то дело и выберем
                  var a2Prob=aProb[1].split("[КАК]");
                  var aSay =  a2Prob[0].split(":");
                  var aProportions =  a2Prob[1].split(":");
                  var nSum = 0;
                  for(var jj=0; jj<aProportions.length; jj++) nSum+=Number(aProportions[jj]);
                  while(Gl_aGenRithm[j].indexOf(sOld)>=0){
                      //!var nRand = Math.floor(fgetRandom()*(nSum+1));
                      var nRand = (Math.random()*(nSum));
                      var k =0;
                      var nSumCurr = 0;
                      while((nSumCurr<=nRand)&&(k<aProportions.length)){
                          nSumCurr+=Number(aProportions[k]);
                          k++;
                      }
                      var sNewChanged=aSay[k-1];//???
                      Gl_aGenRithm[j]=Gl_aGenRithm[j].replace(sOld,sNewChanged);//заменим только первое вхождение,т.к. в след. итерации заново вычислить выбор
                  }
               }
            }
        }
    //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    //alert('перед проговариванием \n'+Gl_aGenRithm[0])
    //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    //ИТОГО СТРОКА ТРЕНИРОВКИ - В Gl_aGenRithm[0]
    var  Gl_sTrain = Gl_aGenRithm[0].split("=")[1];  //??? сделать новую копию а не ссылку


    //== Разбор строки тренировки в массив ============
    Gl_flBegWord = false; //признак что первым элементом массива будет речь(дело) а не интервал
    if (!(Gl_sTrain.trim().indexOf("<#")==0))
      Gl_flBegWord = true;
    else Gl_sTrain = Gl_sTrain.replace("<#","<") //убрать первую решетку если начинается с интервала! чтобы после следующего split и удалений скобок не было пустого первого элемента

    //сделаем чтобы всегда начиналось с интервала
    if  (Gl_flBegWord){
       Gl_sTrain ="<0#>"+Gl_sTrain; //! без первой #
       Gl_flBegWord = false;
    }
    Gl_aRithmLisp = Gl_sTrain.split("#");

    finish_Gl_aRithmLisp()
    //ИТОГОВЫЙ ОДНОМЕРНЫЙ МАССИВ Gl_aRithmLisp
    //alert ('МАССИВ перед проговариванием \n'+Gl_aRithmLisp)
    //=========================================================
    return Gl_aRithmLisp.slice();
    }

    function  finish_Gl_aRithmLisp(){
      for (var i1 = 0; i1 < Gl_aRithmLisp.length; i1++){
          //alert(Gl_aRithmLisp[i1])
          //убираем спецсимволы из речи
          try{
              Gl_aRithmLisp[i1] = Gl_aRithmLisp[i1].split('><').join(' ');
              Gl_aRithmLisp[i1] = Gl_aRithmLisp[i1].split('<').join(' ');
              Gl_aRithmLisp[i1] = Gl_aRithmLisp[i1].split('>').join(' ');
              Gl_aRithmLisp[i1] = Gl_aRithmLisp[i1].split('>').join(' ');
          }catch(e){}
      }

      //ВТОРОЙ ПРОХОД - ВЫЧИСЛЕНИЕ "ОНЛАЙН-ПАРАМЕТРОВ" И ПЕРЕВОД ВРЕМЕНИ В МСЕК
      _номер_итерации_=0
      _прошло_лет_=0
      _прошло_месяцев_=0
      _прошло_недель_=0
      _прошло_дней_=0
      _прошло_часов_=0
      _прошло_минут_=0
      _прошло_секунд_=0
      _прошло_милисекунд_=0
      _history_ = []

      for (var i = 0; i < Gl_aRithmLisp.length; i++){
        if (i%2==0){
          _номер_итерации_+=1;
          Gl_aRithmLisp[i]=calcEval("N",String(Gl_aRithmLisp[i]))
          Gl_aRithmLisp[i+1]=calcEval("S",String(Gl_aRithmLisp[i+1]))
          var nDelta = Math.round(Number(Gl_aRithmLisp[i]));
          var d=new Date();
          var aCurr = [d,Gl_aRithmLisp[i+1]];
          _history_.push(aCurr);
          _прошло_милисекунд_ +=nDelta
          _прошло_секунд_=Math.floor(_прошло_милисекунд_/1000)
          _прошло_минут_=Math.floor(_прошло_милисекунд_/(1000*60))
          _прошло_часов_=Math.floor(_прошло_милисекунд_/(1000*60*60))
          _прошло_дней_=Math.floor(_прошло_милисекунд_/(1000*60*60*24))
          _прошло_недель_=Math.floor(_прошло_милисекунд_/(1000*60*60*24*7))
          _прошло_часов_=Math.floor(_прошло_милисекунд_/(1000*60*60*24*365))
        }
      }

      //Добавим "тренировка завершена"
      var sDelim1 ="%%%%%%%%"
      if (Gl_aRithmLisp.length%2==1)
        Gl_aRithmLisp = (Gl_aRithmLisp.join(sDelim1)+sDelim1+TXT_BTN_FINISHED).split(sDelim1)
      else
         Gl_aRithmLisp = (Gl_aRithmLisp.join(sDelim1)+sDelim1+"1000"+sDelim1+TXT_BTN_FINISHED).split(sDelim1)

  }

  function navigate(i){ // для навигации по делам текущей трени
     if (Gl_decodeExternalCallValue.length=0)
         alert ("Будет произведен переход на дело '"+Gl_aRithmLisp[i]+"'")
     window.speechSynthesis.cancel()

     for(var j=0; j<i;j++){
        try{
          document.getElementById('buttonCurrentTr' + j).style.background='green'
        } catch(e) {}
     }
     for(var k=i; k<Gl_aRithmLisp.length;k++){
        try{
          document.getElementById('buttonCurrentTr' + k).style.background='yellow'
        } catch(e) {}
     }
     GlnDelta = 3000;// Number(Gl_aRithmLisp[i-1]);
     GlnInd =i
  }


  function getText2Print(sTrainName){ //текст для печати
      var aRithmLisp=[]
      var aSimult = []
      if (GltxtSpeek.value.indexOf('[ОДНОВРЕМЕННО С]')>=0){
        arrStr = GltxtSpeek.value.split('[ОДНОВРЕМЕННО С]')
        for (i=0;i<arrStr.length;i++) {
          aSimult.push([[],arrStr[i].split(Gl_sDelim)])
        }
        aRithmLisp = stus(aSimult,'diff')
      }else aRithmLisp=getArithm(GltxtSpeek.value.split(Gl_sDelim));

      //Gl_aRithmLisp=aRithmLisp.slice() //!!!!!!!!!!!

      Gl_txtPrint.value=sTrainName+"\n"
      Gl_txtPrint.value+='Тренировка продлится ' +calcTtrainTime(aRithmLisp)+' минут'+"\n\n"

      var str = ""
      var strNext = ""
      var strPrev = ""
      var nRepeat = 1
      for(var i=1;i<aRithmLisp.length;i+=2){
        str=aRithmLisp[i]+"   :"+aRithmLisp[i+1]+" ms  "+"\n"
        strNext=aRithmLisp[i+2]+"   :"+aRithmLisp[i+1+2]+" ms  "+"\n"
        if ((str!=strNext)){
           Gl_txtPrint.value += aRithmLisp[i]+"   :"+aRithmLisp[i+1]+" ms  "+ ((nRepeat==1)?"":"(повторить "+ nRepeat +" раз)") +"\n"
           nRepeat = 1
        }
        else nRepeat++
        strPrev = str
      }
    }

  //Запускает цикл проговаривания тренировки
  function execTrain1(value, sMode){
    //скрываем календарь
    //?! document.getElementById("idDivActionCalendar").style.display ='none'
    //? document.getElementById("btnRecalcCal").innerHTML = 'Показать календарь'

    if (GlIsRunning) {
      alert("Продолжить тренировку")
    }
    if (!GlIsRunning && sMode=="Run"){
       GlIsRunning =true;
       btnSelectAllTrain.innerHTML = 'Пауза'

       //скрываем/открываем контролы
       document.getElementById("idDivCalendar").style.display ='none'
       document.getElementById("btnRecalcCal").style.display ='none'
       document.getElementById("btnImportCal").style.display ='none'
       document.getElementById("idDivActionCalendar").style.display ='none'
       document.getElementById("btnPrint").style.display ='none'
       document.getElementById("idDivAllTrain").style.display ='none'
       document.getElementById("idTextsToSpeek").style.display ='none'
       document.getElementById("idDivNavigation").style.display ='block'
       document.getElementById("idDivTextTime").style.display ='block'
       document.getElementById("selectedCalendars").style.display ='none'
       document.getElementById("checkPage").style.display ='none'
       document.getElementById("idImpExpAll").style.display ='none'
       document.getElementById("idImpExp").style.display ='none'


       //document.getElementById("idTextTrain").style.display ='block'
       /*
       document.getElementById("idDivTextTime").style.display ='none'// = document.getElementById("selectAllTrain");
       //btnSelectAllTrain = document.getElementById("btnSelectAllTrain");
       //txtTextTime  = document.getElementById("idTextTime");
       //docTextTrain = document.getElementById("idTextTrain");
       //docNoSound = document.getElementById("idNoSound");
       */

    }

    if (sMode=="Calendar")  {
      Gl_currentTrainName = Gl_aMultiCalendar[value].trim()
//???@ OK if calendars are not filtered now (value - from calendars)
      var aEv = Gl_aMetaRithm[getTrainIndexByName("<"+Gl_aMultiCalendar[value].trim()+">")][1]
      GltxtSpeek.value= aEv.join('     '+Gl_sDelim+'\n')
      selectAllTrain.selectedIndex = getTrainIndexByName("<"+Gl_aMultiCalendar[value].trim()+">") //!!!!
      document.getElementById("trainPage").style.display ='block'
      document.getElementById("checkTrainPage").checked = true
      document.getElementById("calendarPage").style.display ='none'
      document.getElementById("checkCalendarPage").checked = false
      document.getElementById("selectedCalendars").style.display ='none'
      document.getElementById("checkPage").style.display ='none'
      alert('Тренировка загружена. Вы можете изменить код тренировки. Для запуска еще раз нажмите кнопку "Начать тренировку." ')
      btnSelectAllTrain.setAttribute('onclick','execTrain1(0,"Run")');
      getText2Print(Gl_currentTrainName)
      return
    } else if (sMode=="Act")  {
      var aSimultTrain =[]
      if (selectAllTrain.getAttribute("multiple")=="multiple"){
        GltxtSpeek.value =''
        Gl_currentTrainName = ''
        for (var i =0; i<selectAllTrain.options.length; i++)
          if (selectAllTrain.options[i].selected){
            Gl_currentTrainName += selectAllTrain.options[i].text + '  \n[ОДНОВРЕМЕННО С]\n   '  //!в наименовании тоже [ОДНОВРЕМЕННО С] - важно для текста печати
            aSimultTrain.push(Gl_aMetaRithm[getTrainIndexByName(selectAllTrain.options[i].text)][1][0])
            //aSimultTrain.push(Gl_aMetaRithm[i][1][0])
          }
      }else{
          Gl_currentTrainName = (Gl_aMetaRithm[value][1][0]).split('=')[0]
          /*
          в случае если треня есть одновременное выполнение других трень (первая строка - перречисление трень через [ОДНОВРЕМЕННО С])
          GltxtSpeek.value должен получиться  в виде "список трени 1 (а не имя трени!) [ОДНОВРЕМЕННО С] список трени 2 (а не имя трени!)..."
          Т.е. в цикле по Gl_aMetaRithm[value][1][0].split('[ОДНОВРЕМЕННО С]') (это имена трень) ищем текущую треню currIndex = найти индекс по имени..,
             берем ее список Gl_aMetaRithm[currIndex][1] и добавляем к GltxtSpeek.value,
             если есть трени за ней (смотрим по длине массива цикла) - добавляем еще "[ОДНОВРЕМЕННО С]"
          */
          GltxtSpeek.value=''
          aSimultTrain = Gl_aMetaRithm[value][1][0].split("[ОДНОВРЕМЕННО С]");
      }

      for(var i=0;i<aSimultTrain.length;i++){
          if ((i==0)&&(aSimultTrain.length>1))
            try{
 //ok getTrainIndexByName
              GltxtSpeek.value+=Gl_aMetaRithm[getTrainIndexByName(aSimultTrain[i].split('=')[1])][1].join('     '+Gl_sDelim+'\n')
            } catch(e){ //падает в режиме множественного выбора
              GltxtSpeek.value+=Gl_aMetaRithm[getTrainIndexByName(aSimultTrain[i].split('=')[0])][1].join('     '+Gl_sDelim+'\n')
            }
          else
            GltxtSpeek.value+=Gl_aMetaRithm[getTrainIndexByName(aSimultTrain[i].split('=')[0])][1].join('     '+Gl_sDelim+'\n')
          if((i<aSimultTrain.length-1)&&(aSimultTrain.length>1)) GltxtSpeek.value+='\n[ОДНОВРЕМЕННО С]\n'
      }

      //alert('Тренировка загружена. Вы можете изменить код тренировки. Для запуска еще раз нажмите кнопку "Начать тренировку." ')
      btnSelectAllTrain.setAttribute('onclick','execTrain1(0,"Run")');

      getText2Print(Gl_currentTrainName)
      return
    } else if (sMode=="Run"){
      //null..
    }

    /*
    getArithm(GltxtSpeek.value.split(Gl_sDelim)); - только если (GltxtSpeek.value.indexOf("[ОДНОВРЕМЕННО С]")>=0)
    иначе в цикле по GltxtSpeek.value.split("[ОДНОВРЕМЕННО С]") начитываем массив для стусовывания aTrain и затем Gl_aRithmLisp =?? stus(aTrain,'diff')
    а в getArithm убираем обработку "[ОДНОВРЕМЕННО С]", тк такой текст теперь не попадает в нее
    */
    /*OLD ???
    if(GltxtSpeek.value.indexOf("[ОДНОВРЕМЕННО С]")>=0){
      var aSimultTrain = GltxtSpeek.value.split("[ОДНОВРЕМЕННО С]"); //arrStr
      var aRet =[]
      for(var i=0;i<aSimultTrain.length;i++)
          aRet.push(Gl_aMetaRithm[getTrainIndexByName(aSimultTrain[i].split('=')[0])])  //OK getTrainIndexByName
      //alert(aRet[0])
      //alert(aRet[1])
      Gl_aRithmLisp = stus(aRet, 'diff')
      //alert(Gl_aRithmLisp)
      finish_Gl_aRithmLisp();  //?? можно просто закомментить?
      //alert('finished')
    } else getArithm(GltxtSpeek.value.split(Gl_sDelim));
    */
    var aRithmLisp=[]
    var aSimult = []
    if (GltxtSpeek.value.indexOf('[ОДНОВРЕМЕННО С]')>=0){
        var arrStr = GltxtSpeek.value.split('[ОДНОВРЕМЕННО С]')
        for (i=0;i<arrStr.length;i++) {
          aSimult.push([[],arrStr[i].split(Gl_sDelim)])
        }
        Gl_aRithmLisp = stus(aSimult,'diff')
    }else aRithmLisp=getArithm(GltxtSpeek.value.split(Gl_sDelim));


    //=========НАЧИТКА СПИСКА ДЕЛ ДЛЯ НАВИГАЦИИ===========
    currentT.innerHTML = '';
    var nId=''
    var prevId = '*'
    var prevText = '';//Gl_aRithmLisp[1]
    var nRepeat = 1
    for(var i=1; i<Gl_aRithmLisp.length; i+=2) {
        var sDelta = Gl_aRithmLisp[i-1]
        try{if (!(sDelta.indexOf('[')>=0)) sDelta+=' [МСЕК]';}catch(e){sDelta = sDelta.toString()+' [МСЕК]'}  //try-ПРОБЛЕМА С ИНТЕРВАЛОМ ПРИ СТУСОВЫВАНИ
        if ((Gl_aRithmLisp[i]==prevText)&&(prevId!='*')){
          nRepeat+=1
          nId=addAction("currentTShort",currentT,sDelta+"   ,"+Gl_aRithmLisp[i],i,false,false,"width:100%",false,prevId,nRepeat)
        }else{
            nId=addAction("currentT",currentT,sDelta+"   ,"+Gl_aRithmLisp[i],i,false,false,"width:100%",false)
            nRepeat = 1
        }
        prevId=nId
        prevText=Gl_aRithmLisp[i]
    }

    //== Вывод  тренировки в текстовом виде
    if (sMode!="Run") fgetTextToPrint()

    //== Проговаривание тренировки по массиву
    Gl_State = TXT_BTN_STARTED
    if (1==1) //(button.firstChild.data == TXT_BTN_NOTSTARTED)
    {


    //#####  ѓлавный цикл с задержками по 1 мс  ######################################## 
      GlnDelta=0;
      GlnInd=0;
      if (!Gl_flBegWord){
           GlnDelta = Number(Gl_aRithmLisp[0]);
           GlnInd =1;
      }
      //  alert(Gl_aRithmLisp)
      //if (
      //  (button.firstChild.data == TXT_BTN_NOTSTARTED)  ||
      //  (button.firstChild.data == TXT_BTN_STARTED)     ||
      //  (button.firstChild.data == TXT_BTN_PAUSED))
        {
            setInterval(fSayInTime,10);  //цикл с задержками по 10 мс
        }
    //##################################################################################


    }

    }


    //Печать тренировки
    function CallPrint() {
      GltxtSpeek.value=Gl_txtPrint.value
      document.getElementById("idDivCalendar").style.display ='none'
      document.getElementById("btnRecalcCal").style.display ='none'
      document.getElementById("btnImportCal").style.display ='none'
      document.getElementById("idDivActionCalendar").style.display ='none'
      document.getElementById("btnPrint").style.display ='none'
      document.getElementById("idDivAllTrain").style.display ='none'
      document.getElementById("idDivNavigation").style.display ='none'
      document.getElementById("idDivTextTime").style.display ='none'
      document.getElementById("idNoSound").style.display ='none'
      document.getElementById("idDivStatrPause").style.display ='none'
      document.getElementById("selectedCalendars").style.display ='none'
      document.getElementById("checkPage").style.display ='none'
      //
      document.getElementById("idTextsToSpeek").style.height =(200+document.getElementById("idTextsToSpeek").scrollHeight)+"px"
   }

   function btnPrintOnClick(){
     CallPrint()
   }

    function beep(f, d) { // частота в герцах, длительность в секундах
      var ctx = new AudioContext();
      var oscillator = ctx.createOscillator();
      oscillator.frequency.value = f;
      oscillator.connect(ctx.destination);
      oscillator.start();
      oscillator.stop(d);
    }

    function beep2(f, d) {
      var volume = 10000,
        u1 = -volume,
        u2 = volume,
        u = u1,
        samples = [],
        titlestring = decodeURIComponent(escape(window.atob("UklGRgAAAABXQVZFZm10IBAAAAABAAIARMKsAAAQwrECAAQAEABkYXRh"))),
        title = [];
      for (i = 0; i < titlestring.length; i++) title[i] = titlestring.charCodeAt(i);
      for (i = 0; i < d * 44100; i++) {
        u += f;
        if (u > u2) u = u1;
        samples[i] = u;
      }
      var outbuffer = new Int16Array(title.length / 2 + samples.length * 2);
      for (i = 0; i < title.length; i += 2) outbuffer[i / 2] = title[i] + title[i + 1] * 256;
      for (i = 0; i < samples.length * 2; i++) outbuffer[i * 2 + 44] = outbuffer[i * 2 + 45] = samples[i];
      var audio = new Audio(URL.createObjectURL(new Blob([outbuffer])));
      audio.play();

    }


/*Формат под EVAL
1. Удаление пробелов взде кроме кавычек  (цикл по строке  3 флага открытия-закрытия для 3х типов кавычек)
2. Замена [ВЫБОР ИЗ]... [КАК] на fselect([массив ф-й (!с () в конце вроде надо..],[массив проп])
3. Замена >={ На function

*/
/*
<Комплекс упражнений на расслабление>=1<цикл расслабление 1>;
<цикл расслабление 1>==<1.>;<2.>;<3.>;<4.>;<5.>;<6.>;
//Упражнениями на расслабление решается задача быстрого восстановления функций организма после физической нагрузки, повышения работоспособности детей и перевод их из одного эмоционального состояния (возбужденного) в другое (спокойное).                Целесообразно использовать следующие упражнения на расслабление, причём в определенной последовательности:
<1.>=< Потряхивание расслабленными кистями рук, всей рукой, обеими руками. Стряхнули воду с рук>;<#4000#>;25<КОМАНДА>
<2.>=< Поочередное потряхивание правой   (левой) расслабленной ногой. Стряхнули  снег с ботинка>;<#4000#>;25<КОМАНДА>
//Слова учителя, сопровождающие это упражнение, направлены на то, чтобы вызвать мышечное ощущение расслабления в конечностях: «Стряхнули водичку с рук»; «Стряхнули  снег с ботинка».
<3.>=< Повороты вправо  (влево)  всего корпуса и расслабленных рук («Руки как плети», «Как ветви обвивают ствол дерева при ветре»).>;<#4000#>;25<КОМАНДА>
<4.>=< Семенящий бег на месте, носки не отрывать от пола, руки вдоль туловища. Движения конечностей, туловища расслаблены.>;<#4000#>;25<КОМАНДА>
<5.>=< Семенящий  бег с  продвижением    вперед. Вначале дети   медленно  продвигаются в центр круга, затем поворачиваются и двигаются в обратном направлении, расширяя круг.>;<#4000#>;25<КОМАНДА>// Возможно использование семенящего бега и в других построениях.
<6.>=< Дыхательное упражнение стоя на месте и в движении с подниманием расслабленных рук в стороны-вверх   (вдох)     и опусканием    их  (бросить) вниз (выдох). После освоения упражнений на расслабление стоя на месте и в движении переходят к освоению упражнений лежа на полу.


<рассл 2.1.>=< И. п.: лежа на животе, руки свободно лежат на полу в стороны-вверх, голова повернута в удобную для ребенка сторону. 1-2 — руки скользят по полу вниз до бедер, 3-4 — ноги врозь, 5-6 — ноги вместе, 7-8 вернуться в и, п.
 <рассл 2.2.>=< И. п.: лежа на животе, руки под подбородком, локти в стороны. 1-2 — согнуть  правую (левую) ногу, отведя колено в сторону, 3-4 — вернуться в и. п.
То же, без отведения колена в сторону, а сгибая ногу назад.
<рассл 2.3.>=< И. п.: лежа на животе, кисти рук под подбородком, локти в стороны.1-2 — согнуть обе ноги в коленях и отвести их назад. 3-4 — вернуться в и. п.
 <рассл 2.4.>=< И. п.: лежа на спине, руки свободно лежат на полу в стороны-вверх, ноги полусогнуты и разведены в коленях, ступни на полу. 1-2 — поднять руки вперед-вверх, кисти расслаблены, 3-4 — опустить руки вниз, на пол, 5-6 — поднять снова вперед-вверх, 7-8 — вернуться в и. п.
 <рассл 2.5.>=<   И. п.: лежа на спине, руки в стороны-вниз. 1-2— согнуть ноги в коленях и подтянуть их к себе без напряжения, 3-4 вернуться в и. п.
<рассл 2.6.>=< И. п.: лежа на спине, руки в стороны-вниз. 1-2— производить пронацию и супинацию расслабленных стоп.
 <рассл 2.7.>=< И. п.: лежа на спине, руки в стороны-вниз. 1-2 — положить руки на грудную клетку (выдох), 3-4— вернуться в и. п. (вдох).

 После    освоения    этих      упражнений    детей учат    расслабляться    в    неподвижном    состоянии, сначала лежа  на спине на полу, а затем сидя, ноги калачиком     (по-турецки, скрестно).

<рассл 3.1.>=< Ребенок ложится на спину, голову поворачивает в удобную для него сторону, руки в стороны-вниз, ноги полусогнуты, колени разведены в стороны, стопы ног сближены, носки развернуты.

 <рассл 3.2.>=< Чтобы ребенок запомнил мышечное ощущение расслабления, воспитатель предлагает вначале сильно, до дрожи напрячься; сильно вытянуть ноги, оттянув носки; руки, сжав кулаки, подбородок прижать к груди и смотреть на носки. Затем, после 3-4 секунд напряжения у детей непроизвольно наступает расслабление в позе, описанной выше. Оно удерживается вначале 10 секунд; постепенно продолжительность расслабления увеличивается до 1-1,5 минуты.

<рассл 3.3.>=< Наиболее сложной для расслабления является поза сидя, ноги скрестно (калачиком, по-турецки), предплечья рук опираются на колени, кисти расслабленно повисают вниз, спина несколько круглая, голова опущена. Позже детей учат расслабляться в том же положении, но сидя на стульчиках, ноги внизу на полу,

Расслабление сидя и лежа в неподвижном состоянии проводится и с закрытыми глазами. Это дает еще больший эффект, так как исключает воздействие зрительных раздражителей.

Упражнения на  расслабление вначале сопровождаются негромкой речью учителя, который дает команду, объясняет, какое принять положение при напряжении, может сказать, что ноги, руки становятся тяжелыми и теплыми. Это помогает ребенку быстрее расслабиться. Объяснение данного факта заключается в широких возможностях словесного воздействия, на различные физиологические функции организма, на что указывал И. П. Павлов, подчеркивая значение слова как всеобъемлющего мощного раздражителя. Ряд исследователей (К. И. Платонов, 1957; В. И. Дубовский, 1978) показали, что ускорение и замедление частоты пульса, дыхания, изменение величины артериального давления может быть вызвано внушением в бодрствующем состоянии. Выявлены подобные реакции у детей дошкольного возраста и на воздействие спокойной, постепенно затихающей музыки.

Во время расслабления учитель не делает никаких замечаний, не ходит между детьми, сохраняя полную тишину.

В результате систематического применения указанных упражнений дети учатся произвольно расслаблять ту или иную группу мышц или все группы одновременно. В период обучения учитель проверяет, действительно расслабляется ребенок или просто лежит неподвижно (замирает),— он подходит к кому-либо из детей и поднимает его руку за кисть: расслабленная рука тяжелая и как бы «провисает»; если ее отпустить, она сразу падает вниз на подставленную ладонь педагога.
*/
</script>

</body>
</html>